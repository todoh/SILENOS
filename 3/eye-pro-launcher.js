/* SILENOS 3 / eye-pro-launcher.js */
// H -> RECONFIGURACIÓN DE LA VISIÓN (B) PARA ACCESO DIRECTO A LA MATERIA (M)
// Optimización Estética: Ventana Flotante tipo Aplicación HTML.

(function() {
    // Definición de la Materia Pro (M) 
    const APP_PRO_DATA =  
        
{
  "id": "html-1768904735603hzlly",
  "type": "html",
  "title": "procedimiento__nexus___omnigen___flux__v5_2___custom_length.html",
  "content": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>PROCEDIMIENTO (Nexus + OmniGen + Flux) v5.2 - Custom Length</title>\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\" rel=\"stylesheet\">\r\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\r\n    <style>\r\n        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Cinzel:wght@400;700&display=swap');\r\n\r\n        body { background-color: #0f172a; font-family: 'Inter', sans-serif; color: #e2e8f0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }\r\n        \r\n        /* UI Elements */\r\n        .glass-panel { background: rgba(30, 41, 59, 0.9); border-right: 1px solid rgba(255,255,255,0.05); }\r\n        .config-label { font-size: 0.65rem; text-transform: uppercase; font-weight: 700; letter-spacing: 0.05em; color: #94a3b8; margin-bottom: 4px; display: block; }\r\n        .config-input { width: 100%; background: #1e293b; border: 1px solid #334155; color: #f1f5f9; padding: 8px; border-radius: 6px; font-size: 0.8rem; outline: none; transition: all 0.2s; }\r\n        .config-input:focus { border-color: #6366f1; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }\r\n        textarea.config-input { resize: none; height: 80px; }\r\n        \r\n        ::-webkit-scrollbar { width: 6px; }\r\n        ::-webkit-scrollbar-track { background: #0f172a; }\r\n        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }\r\n\r\n        /* --- BOOK VISUALIZER STYLES --- */\r\n        .book-viewport { background-color: #f8fafc; color: #1e293b; font-family: 'Merriweather', serif; overflow-y: auto; scroll-behavior: smooth; position: relative; }\r\n        .book-container { max-width: 760px; margin: 0 auto; padding: 60px 40px; min-height: 100%; background: white; box-shadow: 0 0 50px rgba(0,0,0,0.1); }\r\n        \r\n        /* Portada y Capítulo 0 */\r\n        .book-cover-container { display: flex; flex-direction: column; align-items: center; text-align: center; margin-bottom: 4rem; page-break-after: always; }\r\n        .book-main-title { font-family: 'Cinzel', serif; font-size: 3rem; font-weight: 700; line-height: 1.2; margin-bottom: 2rem; color: #0f172a; text-transform: uppercase; letter-spacing: 0.05em; }\r\n        .book-cover-img { width: 100%; max-width: 400px; height: auto; border-radius: 4px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.3); margin-bottom: 2rem; aspect-ratio: 9/16; object-fit: cover; }\r\n        .book-synopsis { font-style: italic; color: #475569; max-width: 80%; margin: 0 auto 3rem auto; font-size: 1rem; line-height: 1.6; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; padding: 1.5rem 0; }\r\n        \r\n        .book-index { background: #f8fafc; padding: 2rem; border-radius: 8px; width: 100%; text-align: left; }\r\n        .book-index h3 { font-family: 'Inter', sans-serif; font-weight: 700; text-transform: uppercase; font-size: 0.9rem; color: #94a3b8; margin-bottom: 1rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem; }\r\n        .book-index ul { list-style: none; padding: 0; }\r\n        .book-index li { padding: 0.5rem 0; border-bottom: 1px dashed #e2e8f0; font-size: 0.9rem; color: #334155; display: flex; justify-content: space-between; }\r\n        .book-index li span:first-child { font-weight: bold; margin-right: 1rem; }\r\n\r\n        /* Contenido General */\r\n        .book-content h1 { font-family: 'Inter', sans-serif; font-weight: 900; font-size: 2.5rem; text-align: center; margin-bottom: 3rem; color: #0f172a; }\r\n        .book-content h2 { font-family: 'Inter', sans-serif; font-weight: 700; font-size: 1.8rem; margin-top: 4rem; margin-bottom: 1.5rem; border-bottom: 2px solid #0f172a; padding-bottom: 0.5rem; color: #0f172a; }\r\n        .book-content p { font-size: 1.125rem; line-height: 1.9; margin-bottom: 1.5em; text-align: justify; }\r\n        \r\n        .book-img-wrapper { margin: 2.5rem 0; text-align: center; animation: fadeIn 1s ease-out; }\r\n        .book-img { max-width: 100%; height: auto; border-radius: 4px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }\r\n        .book-img-caption { font-size: 0.75rem; color: #64748b; margin-top: 0.5rem; font-style: italic; font-family: 'Inter', sans-serif; }\r\n\r\n        /* --- DATABASE VISUALIZER STYLES --- */\r\n        .db-container { display: none; padding: 40px; max-width: 1200px; margin: 0 auto; }\r\n        .db-container.active { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; animation: fadeIn 0.5s; }\r\n        \r\n        .db-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; transition: transform 0.2s; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }\r\n        .db-card:hover { transform: translateY(-5px); border-color: #6366f1; }\r\n        .db-card-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #0f172a; border-bottom: 1px solid #334155; }\r\n        .db-card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }\r\n        .db-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.65rem; font-weight: bold; text-transform: uppercase; margin-bottom: 8px; background: rgba(99, 102, 241, 0.1); color: #818cf8; border: 1px solid rgba(99, 102, 241, 0.2); width: fit-content; }\r\n        .db-title { font-weight: 700; color: #f1f5f9; font-size: 1.1rem; margin-bottom: 6px; font-family: 'Cinzel', serif; }\r\n        .db-desc { font-size: 0.8rem; color: #94a3b8; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }\r\n\r\n        /* Animation & Logs */\r\n        .log-line { font-family: 'Courier New', monospace; font-size: 0.7rem; padding: 2px 0; border-left: 2px solid transparent; padding-left: 8px; animation: fadeIn 0.3s forwards; opacity: 0; }\r\n        .log-info { color: #94a3b8; border-color: #475569; }\r\n        .log-success { color: #4ade80; border-color: #22c55e; }\r\n        .log-process { color: #818cf8; border-color: #6366f1; }\r\n        .log-error { color: #f87171; border-color: #ef4444; }\r\n        @keyframes fadeIn { to { opacity: 1; } }\r\n\r\n        /* UI Components */\r\n        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }\r\n        .switch input { opacity: 0; width: 0; height: 0; }\r\n        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 20px; }\r\n        .slider:before { position: absolute; content: \"\"; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }\r\n        input:checked + .slider { background-color: #6366f1; }\r\n        input:checked + .slider:before { transform: translateX(20px); }\r\n\r\n        .btn-primary { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; font-weight: bold; border: none; padding: 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s; width: 100%; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3); }\r\n        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4); }\r\n        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }\r\n\r\n        .progress-container { position: absolute; top: 0; left: 0; width: 100%; height: 3px; z-index: 50; }\r\n        .progress-bar { height: 100%; background: linear-gradient(90deg, #22d3ee, #818cf8, #e879f9); width: 0%; transition: width 0.3s; }\r\n\r\n        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }\r\n        .modal-box { background: #1e293b; width: 400px; max-height: 70vh; border-radius: 12px; border: 1px solid #334155; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); }\r\n    \r\n        /* View Switcher */\r\n        .view-switcher { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); z-index: 40; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); padding: 4px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); display: flex; gap: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }\r\n        .view-btn { padding: 6px 16px; border-radius: 16px; font-size: 0.75rem; font-weight: bold; color: #94a3b8; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; }\r\n        .view-btn.active { background: #6366f1; color: white; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4); }\r\n        .view-btn:hover:not(.active) { color: #f8fafc; background: rgba(255,255,255,0.05); }\r\n\r\n    </style>\r\n</head>\r\n<body>\r\n\r\n    <div id=\"folder-modal\" class=\"modal-overlay hidden\">\r\n        <div class=\"modal-box\">\r\n            <div class=\"p-4 border-b border-slate-700 bg-slate-800 flex justify-between items-center\">\r\n                <h3 class=\"text-xs font-bold text-slate-300 uppercase tracking-wider\"><i class=\"fa-solid fa-folder-tree mr-2 text-indigo-400\"></i>Seleccionar Destino</h3>\r\n                <button onclick=\"ui.toggleModal()\" class=\"text-slate-500 hover:text-white\"><i class=\"fa-solid fa-xmark\"></i></button>\r\n            </div>\r\n            <div id=\"folder-list\" class=\"flex-1 overflow-y-auto p-2 space-y-1\"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"progress-container\"><div id=\"global-progress\" class=\"progress-bar\"></div></div>\r\n\r\n    <header class=\"h-14 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-5 shrink-0 z-20\">\r\n        <div class=\"flex items-center gap-3\">\r\n            <div class=\"w-8 h-8 bg-indigo-600 rounded flex items-center justify-center text-white shadow-lg\">\r\n                <i class=\"fa-solid fa-layer-group\"></i>\r\n            </div>\r\n            <div>\r\n                <h1 class=\"font-bold text-slate-100 text-sm tracking-wide\">PROCEDIMIENTO <span class=\"text-xs text-indigo-400 font-normal opacity-70\">| v5.2 (Custom Length)</span></h1>\r\n            </div>\r\n        </div>\r\n        <div class=\"flex items-center gap-4\">\r\n            <div class=\"flex flex-col items-end border-r border-slate-700 pr-4 mr-2\">\r\n                <span class=\"text-[9px] text-slate-500 font-bold uppercase\">Guardar en</span>\r\n                <button onclick=\"ui.toggleModal()\" id=\"target-folder-label\" class=\"text-xs font-bold text-indigo-400 hover:text-indigo-300 truncate max-w-[150px] transition-colors\">\r\n                    <i class=\"fa-regular fa-folder-open mr-1\"></i> Seleccionar...\r\n                </button>\r\n            </div>\r\n            <div class=\"text-[10px] text-slate-500 font-mono\" id=\"system-status\">SISTEMA EN ESPERA</div>\r\n            <button id=\"auth-btn\" onclick=\"auth.toggle()\" class=\"px-3 py-1 bg-yellow-500/10 border border-yellow-500/50 text-yellow-500 text-[10px] font-bold rounded hover:bg-yellow-500 hover:text-black transition-all\">\r\n                CONECTAR IA\r\n            </button>\r\n        </div>\r\n    </header>\r\n\r\n    <main class=\"flex-1 flex overflow-hidden\">\r\n        <aside class=\"w-80 glass-panel flex flex-col p-5 overflow-y-auto shrink-0 z-10 bg-slate-900 border-r border-slate-800 shadow-xl\">\r\n            <div class=\"space-y-5 mb-8\">\r\n                <div>\r\n                    <span class=\"config-label\"><i class=\"fa-solid fa-pen-nib mr-1\"></i> Premisa Narrativa</span>\r\n                    <textarea id=\"inp-narrative\" class=\"config-input\" placeholder=\"Ej. Un imperio galáctico en decadencia descubre que su dios es una IA corrupta...\"></textarea>\r\n                </div>\r\n                <div>\r\n                    <span class=\"config-label\"><i class=\"fa-solid fa-palette mr-1\"></i> Estilo Visual (Prompt)</span>\r\n                    <textarea id=\"inp-visual\" class=\"config-input\" placeholder=\"Ej. Cinematic Sci-Fi, Dune aesthetic, brutalism, golden hour, 8k...\"></textarea>\r\n                </div>\r\n                <div class=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <span class=\"config-label\"><i class=\"fa-solid fa-clock mr-1\"></i> N.º Capítulos</span>\r\n                        <input type=\"number\" id=\"inp-duration\" class=\"config-input\" value=\"12\" min=\"1\" max=\"50\">\r\n                    </div>\r\n                    <div>\r\n                        <span class=\"config-label\"><i class=\"fa-solid fa-image mr-1\"></i> Ilustrar</span>\r\n                        <div class=\"flex items-center gap-2 mt-2\">\r\n                            <label class=\"switch\">\r\n                                <input type=\"checkbox\" id=\"inp-images\" checked>\r\n                                <span class=\"slider\"></span>\r\n                            </label>\r\n                            <span class=\"text-xs text-slate-400\">Flux ON</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <button id=\"btn-start\" onclick=\"engine.start()\" class=\"btn-primary\">\r\n                <i class=\"fa-solid fa-play mr-2\"></i> EJECUTAR PROCEDIMIENTO\r\n            </button>\r\n            <div class=\"mt-auto pt-6 border-t border-slate-800\">\r\n                <span class=\"config-label mb-2\">Registro de Procesos</span>\r\n                <div id=\"console-output\" class=\"h-48 overflow-y-auto bg-slate-950 rounded p-2 font-mono text-xs space-y-1 border border-slate-800 shadow-inner\">\r\n                    <div class=\"log-line log-info\">Esperando configuración...</div>\r\n                </div>\r\n            </div>\r\n        </aside>\r\n\r\n        <section id=\"main-viewport\" class=\"flex-1 relative bg-slate-900\">\r\n            <div class=\"view-switcher\">\r\n                <button class=\"view-btn active\" id=\"btn-view-book\" onclick=\"ui.switchView('book')\"><i class=\"fa-solid fa-book-open mr-2\"></i>Manuscrito</button>\r\n                <button class=\"view-btn\" id=\"btn-view-data\" onclick=\"ui.switchView('data')\"><i class=\"fa-solid fa-database mr-2\"></i>Base de Datos</button>\r\n            </div>\r\n\r\n            <div id=\"view-book\" class=\"book-viewport h-full\">\r\n                <div class=\"book-container\">\r\n                    <div id=\"preview-content\" class=\"book-content fade-in\">\r\n                        <div class=\"flex flex-col items-center justify-center h-96 text-slate-300 opacity-50\">\r\n                            <i class=\"fa-solid fa-book-open text-5xl mb-6\"></i>\r\n                            <p class=\"text-sm font-sans uppercase tracking-widest\">El libro se generará aquí</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div id=\"view-data\" class=\"book-viewport h-full hidden\" style=\"background-color: #0f172a;\">\r\n                <div id=\"db-content\" class=\"db-container active\">\r\n                    </div>\r\n            </div>\r\n\r\n        </section>\r\n    </main>\r\n\r\n    <script>\r\n        /* --- CONSTANTS: WORLD TYPES --- */\r\n        const WORLD_TYPES = [\r\n            \"Personaje\", \"Ubicación\", \"Organización\", \"Evento\", \"Objeto\", \"Raza (o Especie)\", \"Criatura (Fauna)\", \r\n            \"Flora (Plantas)\", \"Religión\", \"Magia (Hechizo/Sistema)\", \"Tecnología\", \"Ideología\", \"Idioma\", \r\n            \"Gobierno (Sistema político)\", \"Ley (Legislación)\", \"Enfermedad\", \"Medicina (Tratamientos/Drogas)\", \r\n            \"Vehículo\", \"Arma\", \"Vestimenta (Atuendo/Uniforme)\", \"Alimento (Comida/Bebida)\", \"Recurso (Material/Mineral)\", \r\n            \"Moneda (Divisa)\", \"Profesión (Oficio)\", \"Clase Social\", \"Familia (Linaje/Casa)\", \"Planeta (Cuerpo Celeste)\", \r\n            \"Región (Geográfica)\", \"Ciudad (Asentamiento)\", \"Edificio (Monumento/Ruina)\", \"Fenómeno (Climático/Sobrenatural)\", \r\n            \"Mito (Leyenda/Folclore)\", \"Profecía\", \"Sueño (Visión)\", \"Tradición (Costumbre)\", \"Festividad\", \r\n            \"Conflicto (Guerra)\", \"Batalla (Enfrentamiento táctico)\", \"Tratado (Alianza/Acuerdo)\", \"Documento (Libro/Carta/Mapa)\", \r\n            \"Símbolo (Heráldica/Bandera)\", \"Arte (Música/Pintura/Escultura)\", \"Juego (Deporte/Entretenimiento)\", \r\n            \"Era (Periodo histórico)\", \"Habilidad (Poder/Talento)\", \"Misión (Quest/Objetivo)\", \"Trama (Arco argumental)\", \r\n            \"Escena\", \"Concepto (Idea abstracta)\", \"Nota (Meta-dato/Apunte)\"\r\n        ];\r\n\r\n        /* --- 1. AUTH SYSTEM --- */\r\n        const auth = {\r\n            key: localStorage.getItem('pollinations_api_key'),\r\n            init() {\r\n                this.updateUI();\r\n                window.addEventListener('message', (event) => {\r\n                    if (event.data && event.data.type === 'POLLI_AUTH_SUCCESS' && event.data.key) {\r\n                        this.key = event.data.key;\r\n                        localStorage.setItem('pollinations_api_key', this.key);\r\n                        this.updateUI();\r\n                    }\r\n                });\r\n            },\r\n            toggle() {\r\n                if (this.key) {\r\n                    if(confirm(\"¿Desconectar?\")) { localStorage.removeItem('pollinations_api_key'); this.key = null; this.updateUI(); }\r\n                } else {\r\n                    const redirectUrl = encodeURIComponent(window.location.href); \r\n                    window.open(`https://enter.pollinations.ai/authorize?redirect_url=${redirectUrl}`, 'PollinationsAuth', `width=500,height=700`);\r\n                }\r\n            },\r\n            updateUI() {\r\n                const btn = document.getElementById('auth-btn');\r\n                if (this.key) {\r\n                    btn.innerHTML = '<i class=\"fa-solid fa-link\"></i> CONECTADO';\r\n                    btn.className = \"px-3 py-1 bg-green-500/10 border border-green-500/50 text-green-400 text-[10px] font-bold rounded hover:bg-green-500 hover:text-black transition-all\";\r\n                } else {\r\n                    btn.innerHTML = '<i class=\"fa-solid fa-plug\"></i> CONECTAR IA';\r\n                    btn.className = \"px-3 py-1 bg-yellow-500/10 border border-yellow-500/50 text-yellow-500 text-[10px] font-bold rounded hover:bg-yellow-500 hover:text-black transition-all\";\r\n                }\r\n            }\r\n        };\r\n\r\n        /* --- 2. FILE SYSTEM MOCK (JSON COMPATIBLE) --- */\r\n        const fs = {\r\n            data: window.parent && window.parent.FileSystem ? window.parent.FileSystem.data : [{id: 'root', title: 'Escritorio', type: 'folder'}],\r\n            api: window.parent && window.parent.FileSystem ? window.parent.FileSystem : null,\r\n            \r\n            async save() { if (this.api && this.api.save) await this.api.save(); },\r\n            \r\n            createFolder(title, parentId = 'root') {\r\n                const id = 'folder-' + Date.now();\r\n                const folder = { \r\n                    id: id, \r\n                    type: 'folder', \r\n                    title: title, \r\n                    parentId: parentId, \r\n                    content: { files: [] }, \r\n                    icon: 'folder-tree', \r\n                    color: 'text-indigo-400' \r\n                };\r\n                if (this.api) this.api.data.push(folder); else this.data.push(folder);\r\n                return id;\r\n            },\r\n\r\n            createItem(title, type, content, parentId, icon='file', color='text-slate-400') {\r\n                const id = 'narrative-' + Date.now() + Math.floor(Math.random() * 100000);\r\n                \r\n                const item = { \r\n                    id: id, \r\n                    type: type, \r\n                    title: title, \r\n                    parentId: parentId, \r\n                    content: content, \r\n                    x: 0,\r\n                    y: 0,\r\n                    z: 0,\r\n                    icon: icon, \r\n                    color: color \r\n                };\r\n                if (this.api) this.api.data.push(item); else this.data.push(item);\r\n                return item;\r\n            },\r\n\r\n            addChapter(bookId, chapterTitle) {\r\n                if(!this.api && !this.data) return;\r\n                const db = this.api ? this.api.data : this.data;\r\n                const book = db.find(x => x.id === bookId);\r\n                if(book && book.content.chapters) {\r\n                    book.content.chapters.push({ title: chapterTitle, paragraphs: [] });\r\n                    this.save();\r\n                }\r\n            },\r\n\r\n            updateBook(id, htmlContent) {\r\n                if(!this.api && !this.data) return;\r\n                const db = this.api ? this.api.data : this.data;\r\n                const book = db.find(x => x.id === id);\r\n                if(book) {\r\n                    if(!book.content.chapters) book.content.chapters = [];\r\n                    if(book.content.chapters.length === 0) book.content.chapters.push({ title: \"Inicio\", paragraphs: [] });\r\n                    \r\n                    const currentChapter = book.content.chapters[book.content.chapters.length - 1];\r\n                    if(currentChapter && currentChapter.paragraphs) {\r\n                        currentChapter.paragraphs.push(htmlContent);\r\n                        this.save();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        /* --- 3. UI UTILITIES --- */\r\n        const ui = {\r\n            targetFolderId: null,\r\n            toggleModal() {\r\n                const modal = document.getElementById('folder-modal');\r\n                modal.classList.toggle('hidden');\r\n                if(!modal.classList.contains('hidden')) this.renderFolders();\r\n            },\r\n            renderFolders() {\r\n                const list = document.getElementById('folder-list'); list.innerHTML = '';\r\n                const folders = fs.data.filter(i => i.type === 'folder');\r\n                folders.forEach(f => {\r\n                    const el = document.createElement('div');\r\n                    el.className = \"p-3 hover:bg-slate-700 cursor-pointer border-b border-slate-700 flex items-center gap-3 text-slate-300 rounded transition-colors\";\r\n                    el.innerHTML = `<i class=\"fa-solid fa-folder text-indigo-400\"></i><span class=\"text-xs font-bold\">${f.title}</span>`;\r\n                    el.onclick = () => {\r\n                        this.targetFolderId = f.id;\r\n                        document.getElementById('target-folder-label').innerHTML = `<i class=\"fa-solid fa-folder-open mr-1\"></i> ${f.title}`;\r\n                        this.toggleModal();\r\n                    };\r\n                    list.appendChild(el);\r\n                });\r\n            },\r\n            log(msg, type='info') {\r\n                const consoleEl = document.getElementById('console-output');\r\n                const div = document.createElement('div');\r\n                div.className = `log-line log-${type}`;\r\n                div.innerText = `> ${msg}`;\r\n                consoleEl.prepend(div);\r\n                document.getElementById('system-status').innerText = msg.toUpperCase().substring(0, 30);\r\n            },\r\n            cleanJSON(str) {\r\n                if(!str) return \"[]\";\r\n                str = str.replace(/```json/g, '').replace(/```/g, '');\r\n                const firstBracket = str.indexOf('['); const firstBrace = str.indexOf('{');\r\n                const lastBracket = str.lastIndexOf(']'); const lastBrace = str.lastIndexOf('}');\r\n                \r\n                if (firstBracket !== -1 && lastBracket !== -1 && (firstBrace === -1 || firstBracket < firstBrace)) {\r\n                    return str.substring(firstBracket, lastBracket + 1);\r\n                }\r\n                if (firstBrace !== -1 && lastBrace !== -1) {\r\n                    return str.substring(firstBrace, lastBrace + 1);\r\n                }\r\n                return str;\r\n            },\r\n            appendBookContent(html, clear=false) {\r\n                const container = document.getElementById('preview-content');\r\n                if (clear || container.querySelector('.fa-book-open')) container.innerHTML = \"\";\r\n                const div = document.createElement('div'); div.innerHTML = html; div.className = \"animate-fade-in\";\r\n                container.appendChild(div);\r\n                const viewport = document.getElementById('view-book'); \r\n                setTimeout(() => viewport.scrollTo({ top: viewport.scrollHeight, behavior: 'smooth' }), 100);\r\n            },\r\n            \r\n            switchView(viewName) {\r\n                document.getElementById('btn-view-book').classList.remove('active');\r\n                document.getElementById('btn-view-data').classList.remove('active');\r\n                document.getElementById('view-book').classList.add('hidden');\r\n                document.getElementById('view-data').classList.add('hidden');\r\n\r\n                if(viewName === 'book') {\r\n                    document.getElementById('btn-view-book').classList.add('active');\r\n                    document.getElementById('view-book').classList.remove('hidden');\r\n                } else {\r\n                    document.getElementById('btn-view-data').classList.add('active');\r\n                    document.getElementById('view-data').classList.remove('hidden');\r\n                }\r\n            },\r\n            renderDatabaseCard(item) {\r\n                const container = document.getElementById('db-content');\r\n                const card = document.createElement('div');\r\n                card.className = \"db-card fade-in\";\r\n                card.innerHTML = `\r\n                    <img src=\"${item.imageUrl || 'https://via.placeholder.com/512?text=No+Image'}\" class=\"db-card-img\" loading=\"lazy\">\r\n                    <div class=\"db-card-body\">\r\n                        <span class=\"db-badge\">${item.type}</span>\r\n                        <h4 class=\"db-title\">${item.name}</h4>\r\n                        <p class=\"db-desc\">${item.narrativeDesc}</p>\r\n                    </div>\r\n                `;\r\n                container.appendChild(card);\r\n            },\r\n\r\n            sleep(ms) { return new Promise(r => setTimeout(r, ms)); }\r\n        };\r\n\r\n        /* --- 4. ENGINE (UPDATED FOR CUSTOM LENGTH) --- */\r\n        const engine = {\r\n            state: { running: false, config: {}, rootFolderId: null, bookId: null, database: [], timeline: [], contextBuffer: \"\" },\r\n\r\n            async runBatch(items, batchSize, asyncFn) {\r\n                let results = [];\r\n                for (let i = 0; i < items.length; i += batchSize) {\r\n                    const chunk = items.slice(i, i + batchSize);\r\n                    ui.log(`Procesando lote ${Math.floor(i/batchSize)+1}/${Math.ceil(items.length/batchSize)}...`, \"process\");\r\n                    const batchResults = await Promise.all(chunk.map(item => asyncFn(item)));\r\n                    results.push(...batchResults);\r\n                    await ui.sleep(1000); \r\n                }\r\n                return results;\r\n            },\r\n\r\n            async aiCall(systemPrompt, userPrompt, model='gemini') {\r\n                if (!auth.key) throw new Error(\"Sin API Key\");\r\n                let attempts = 0;\r\n                while(attempts < 3) {\r\n                    try {\r\n                        const res = await fetch('https://gen.pollinations.ai/v1/chat/completions', {\r\n                            method: 'POST',\r\n                            headers: { 'Authorization': `Bearer ${auth.key}`, 'Content-Type': 'application/json' },\r\n                            body: JSON.stringify({ model: model, messages: [{ role: 'system', content: systemPrompt }, { role: 'user', content: userPrompt }], temperature: 0.85 })\r\n                        });\r\n                        if(!res.ok) throw new Error(`HTTP ${res.status}`);\r\n                        const data = await res.json();\r\n                        return data.choices[0].message.content;\r\n                    } catch(e) { \r\n                        attempts++;\r\n                        console.error(`Intento ${attempts} fallido:`, e);\r\n                        await ui.sleep(2000 * attempts);\r\n                        if(attempts >= 3) { ui.log(\"Error IA persistente: \" + e.message, \"error\"); throw e; }\r\n                    }\r\n                }\r\n            },\r\n\r\n            async imgCall(prompt, width=1280, height=720) {\r\n                const seed = Math.floor(Math.random() * 1000000);\r\n                const safePrompt = encodeURIComponent(prompt.trim());\r\n                const url = `https://gen.pollinations.ai/image/${safePrompt}?model=klein&width=${width}&height=${height}&seed=${seed}&nologo=true&key=${auth.key}`;\r\n                const res = await fetch(url);\r\n                if(!res.ok) throw new Error(\"Error imagen\");\r\n                const blob = await res.blob();\r\n                return new Promise((resolve) => {\r\n                    const reader = new FileReader();\r\n                    reader.onloadend = () => resolve(reader.result);\r\n                    reader.readAsDataURL(blob);\r\n                });\r\n            },\r\n\r\n            async start() {\r\n                if(this.state.running) return;\r\n                if(!auth.key) return alert(\"Conecta la IA primero.\");\r\n                if(!ui.targetFolderId) return alert(\"¡Selecciona CARPETA DE DESTINO!\");\r\n                \r\n                const narrative = document.getElementById('inp-narrative').value;\r\n                const visual = document.getElementById('inp-visual').value;\r\n                if(!narrative) return alert(\"Falta premisa.\");\r\n\r\n                this.state.running = true;\r\n                \r\n                // MODIFICACION: Leer valor numérico directo para duración\r\n                const rawDuration = document.getElementById('inp-duration').value;\r\n                const duration = parseInt(rawDuration) || 12; // Default a 12 si falla\r\n\r\n                this.state.config = { \r\n                    narrative, \r\n                    visual, \r\n                    duration: duration, \r\n                    images: document.getElementById('inp-images').checked \r\n                };\r\n                \r\n                document.getElementById('btn-start').disabled = true;\r\n                document.getElementById('preview-content').innerHTML = `<div class=\"p-10 text-center\"><h1 class=\"animate-pulse text-indigo-600\">Iniciando Procedimiento Extendido...</h1></div>`;\r\n\r\n                try {\r\n                    await this.phase1_GenesisAndWorld();\r\n                    ui.switchView('book');\r\n                    await this.phase2_Production();\r\n                    ui.log(\"PROCEDIMIENTO COMPLETADO.\", \"success\");\r\n                    ui.appendBookContent(\"<div class='mt-12 pt-12 border-t border-slate-200 text-center text-slate-400 font-bold uppercase tracking-widest text-xs'>Fin del Manuscrito</div>\");\r\n                } catch(e) {\r\n                    ui.log(\"ERROR CRÍTICO: \" + e.message, \"error\");\r\n                    console.error(e);\r\n                } finally {\r\n                    this.state.running = false;\r\n                    document.getElementById('btn-start').disabled = false;\r\n                }\r\n            },\r\n\r\n            async phase1_GenesisAndWorld() {\r\n                ui.log(\"FASE 1: WORLDBUILDING MASIVO\", \"process\");\r\n                ui.switchView('data'); \r\n                document.getElementById('db-content').innerHTML = '';\r\n\r\n                document.getElementById('global-progress').style.width = \"5%\";\r\n                \r\n                const rootName = \"PROYECTO - \" + new Date().toLocaleTimeString();\r\n                this.state.rootFolderId = fs.createFolder(rootName, ui.targetFolderId);\r\n\r\n                await this.generateDeepWorld();\r\n                await this.generateComplexPlot();\r\n                await this.createBookStructure();\r\n            },\r\n\r\n            async generateDeepWorld() {\r\n                ui.log(\"Seleccionando entidades clave...\", \"info\");\r\n                \r\n                const selectionPrompt = `PREMISA: \"${this.state.config.narrative}\"\r\n                TIPOS DISPONIBLES: ${JSON.stringify(WORLD_TYPES)}\r\n                TAREA: Selecciona los 40 tipos más relevantes para construir este mundo y asignales un nombre creativo.\r\n                FORMATO JSON: [ {\"type\": \"Tipo\", \"name\": \"Nombre Creativo\"} ]`;\r\n                \r\n                const listJson = await this.aiCall(\"Worldbuilder Architect.\", selectionPrompt, 'gemini');\r\n                const entityList = JSON.parse(ui.cleanJSON(listJson));\r\n                \r\n                ui.log(`Generando datos e imágenes para ${entityList.length} entidades...`, \"process\");\r\n\r\n                const detailedEntities = await this.runBatch(entityList, 4, async (item) => {\r\n                    const detailPrompt = `ENTIDAD: ${item.name} (${item.type})\r\n                    HISTORIA: \"${this.state.config.narrative}\"\r\n                    ESTILO VISUAL: \"${this.state.config.visual}\"\r\n                    TAREA: Crea un perfil breve.\r\n                    FORMATO JSON: { \"name\": \"${item.name}\", \"type\": \"${item.type}\", \"narrativeDesc\": \"Resumen narrativo (2 frases)\", \"visualDesc\": \"subject, style details, colors...\" }`;\r\n                    \r\n                    try {\r\n                        const res = await this.aiCall(\"Worldbuilder Detailer.\", detailPrompt, 'gemini-fast');\r\n                        const data = JSON.parse(ui.cleanJSON(res));\r\n\r\n                        try {\r\n                            const imgPrompt = `${data.visualDesc}, ${this.state.config.visual}, high quality, detailed, masterpiece`;\r\n                            data.imageUrl = await this.imgCall(imgPrompt, 512, 512);\r\n                        } catch(err) {\r\n                            console.warn(\"Error generando imagen para \" + item.name, err);\r\n                            data.imageUrl = null; \r\n                        }\r\n                        ui.renderDatabaseCard(data);\r\n                        return data;\r\n\r\n                    } catch(e) { return null; }\r\n                });\r\n\r\n                this.state.database = detailedEntities.filter(e => e !== null);\r\n                \r\n                this.state.database.forEach(d => {\r\n                    let icon = 'cube';\r\n                    if(d.type.includes('Personaje')) icon = 'user';\r\n                    else if(d.type.includes('Objeto')) icon = 'gem';\r\n                    else if(d.type.includes('Lugar') || d.type.includes('Ciudad')) icon = 'map-pin';\r\n                    else if(d.type.includes('Evento')) icon = 'clock';\r\n\r\n                    const innerData = {\r\n                        desc: d.narrativeDesc,\r\n                        visualDesc: d.visualDesc,\r\n                        type: d.type,\r\n                        tags: \"Generated, \" + d.type\r\n                    };\r\n\r\n                    fs.createItem(\r\n                        d.name, \r\n                        \"narrative\", \r\n                        { \r\n                            tag: \"Entidad\", \r\n                            text: JSON.stringify(innerData) \r\n                        }, \r\n                        this.state.rootFolderId, \r\n                        icon, \r\n                        'text-emerald-400'\r\n                    );\r\n                });\r\n\r\n                await fs.save();\r\n                ui.log(`Base de datos creada: ${this.state.database.length} registros.`, \"success\");\r\n                document.getElementById('global-progress').style.width = \"25%\";\r\n            },\r\n\r\n            async generateComplexPlot() {\r\n                ui.log(\"Diseñando arquitectura narrativa...\", \"process\");\r\n                const contextDB = this.state.database.map(d => `${d.name} (${d.type})`).join(\", \");\r\n\r\n                const p1 = await this.aiCall(\"Narrative Architect\", `PREMISA: ${this.state.config.narrative}\\nENTIDADES: ${contextDB}\\nCrea la TRAMA PRINCIPAL (Héroe vs Antagonista/Conflicto). Resumen detallado.`, 'gemini');\r\n                const p2 = await this.aiCall(\"Narrative Architect\", `TRAMA PRINCIPAL: ${p1}\\nCrea 2 SUBTRAMAS que se entrelacen (Romance, Traición, Misterio).`, 'gemini');\r\n\r\n                // MODIFICACION: Usar la duración numérica exacta\r\n                let eventsCount = this.state.config.duration;\r\n                \r\n                const masterPrompt = `TRAMA A: ${p1}\\nTRAMA B: ${p2}\\n\r\n                TAREA: Fusiona todo en una cronología coherente de EXACTAMENTE ${eventsCount} EVENTOS principales (Capítulos).\r\n                FORMATO JSON: [ { \"title\": \"Título Evento\", \"description\": \"Qué sucede (narrativo)\", \"characters\": [\"Nombre1\", \"Nombre2\"] } ]`;\r\n                \r\n                const plotJson = await this.aiCall(\"Master Plotter JSON\", masterPrompt, 'gemini');\r\n                const rawTimeline = JSON.parse(ui.cleanJSON(plotJson));\r\n\r\n                ui.log(\"Desglosando eventos en momentos...\", \"process\");\r\n                this.state.timeline = await this.runBatch(rawTimeline, 5, async (ev) => {\r\n                    const momentPrompt = `EVENTO: ${ev.description}\\nPERSONAJES: ${ev.characters.join(\", \")}\\nTAREA: Desglosa este evento en 3-4 \"Momentos\" secuenciales para escribir una escena. (Inicio, Desarrollo, Clímax/Cierre).\r\n                    FORMATO JSON: { \"title\": \"${ev.title}\", \"description\": \"${ev.description}\", \"moments\": [\"Momento 1: Acción visual...\", \"Momento 2: Diálogo...\", \"Momento 3: Consecuencia...\"] }`;\r\n                    try {\r\n                        const res = await this.aiCall(\"Scene Director\", momentPrompt, 'gemini-fast');\r\n                        const parsed = JSON.parse(ui.cleanJSON(res));\r\n                        \r\n                        parsed.moments = parsed.moments.map(m => ({\r\n                            id: Date.now() + Math.random(),\r\n                            text: typeof m === 'string' ? m : (m.text || m.description || \"Momento\")\r\n                        }));\r\n                        return parsed;\r\n\r\n                    } catch(e) { \r\n                        return { \r\n                            ...ev, \r\n                            moments: [{id: Date.now(), text: ev.description}] \r\n                        }; \r\n                    }\r\n                });\r\n\r\n                const timelineData = {\r\n                    id: \"narrative-\" + Date.now(),\r\n                    name: \"Línea Temporal de la Historia\",\r\n                    start: 0,\r\n                    end: this.state.timeline.length + 1,\r\n                    color: \"#3b82f6\",\r\n                    events: this.state.timeline.map((ev, i) => ({\r\n                        id: \"gen-\" + Date.now() + i,\r\n                        time: i + 1,\r\n                        description: ev.title,\r\n                        moments: ev.moments,\r\n                        image64: null\r\n                    }))\r\n                };\r\n\r\n                fs.createItem(\r\n                    \"Línea Temporal de la Historia\", \r\n                    \"narrative\", \r\n                    { \r\n                        tag: \"TEMPORAL\", \r\n                        text: JSON.stringify(timelineData) \r\n                    }, \r\n                    this.state.rootFolderId, \r\n                    'clock', \r\n                    'text-blue-500'\r\n                );\r\n\r\n                await fs.save();\r\n                document.getElementById('global-progress').style.width = \"40%\";\r\n            },\r\n\r\n            async createBookStructure() {\r\n                ui.log(\"Generando portada...\", \"process\");\r\n                const coverPrompt = await this.aiCall(\"Art Director\", `Cover prompt for: ${this.state.config.narrative}. Style: ${this.state.config.visual}. English only.`, 'gemini-fast');\r\n                const coverUrl = await this.imgCall(coverPrompt, 768, 1344);\r\n                \r\n                const synopsis = await this.aiCall(\"Editor\", `Sinopsis comercial (100 palabras): ${this.state.config.narrative}`, 'gemini');\r\n\r\n                let indexHTML = `<div class=\"book-index\"><h3>Índice</h3><ul>`;\r\n                this.state.timeline.forEach((ev, idx) => {\r\n                    indexHTML += `<li><span>Cap ${idx+1}. ${ev.title}</span></li>`;\r\n                });\r\n                indexHTML += `</ul></div>`;\r\n\r\n                const ch0 = `<div class=\"book-cover-container\"><h1 class=\"book-main-title\">GENERATED STORY</h1><img src=\"${coverUrl}\" class=\"book-cover-img\"><div class=\"book-synopsis\">${synopsis}</div>${indexHTML}</div>`;\r\n                \r\n                ui.appendBookContent(ch0, true);\r\n                \r\n                const bookItem = fs.createItem(\"Manuscrito Final\", \"book\", { \r\n                    title: \"Historia\", \r\n                    chapters: [{ title: \"Intro\", paragraphs: [ch0] }], \r\n                    author: \"AI\", created: Date.now() \r\n                }, this.state.rootFolderId, 'book', 'text-rose-400');\r\n                \r\n                this.state.bookId = bookItem.id;\r\n                await fs.save();\r\n            },\r\n\r\n            async phase2_Production() {\r\n                ui.log(\"FASE 2: PRODUCCIÓN DE PROSA\", \"process\");\r\n                const totalEvents = this.state.timeline.length;\r\n                this.state.contextBuffer = \"\";\r\n\r\n                for (let i = 0; i < totalEvents; i++) {\r\n                    const event = this.state.timeline[i];\r\n                    ui.log(`Escribiendo Capítulo ${i+1}: ${event.title}...`, \"process\");\r\n                    \r\n                    fs.addChapter(this.state.bookId, event.title);\r\n                    const titleHTML = `<h2 class=\"chapter-title\">${event.title}</h2>`;\r\n                    ui.appendBookContent(titleHTML);\r\n                    fs.updateBook(this.state.bookId, titleHTML);\r\n\r\n                    for (let m = 0; m < event.moments.length; m++) {\r\n                        const moment = event.moments[m].text; \r\n                        \r\n                        const prose = await this.generateProse(moment, event.description);\r\n                        const htmlText = marked.parse(prose);\r\n                        ui.appendBookContent(htmlText);\r\n                        fs.updateBook(this.state.bookId, htmlText);\r\n                        \r\n                        this.state.contextBuffer += prose.substring(0, 300); \r\n                        if(this.state.contextBuffer.length > 2000) this.state.contextBuffer = this.state.contextBuffer.slice(-2000);\r\n\r\n                        if (this.state.config.images && Math.random() > 0.4) {\r\n                            await this.illustrate(moment, prose);\r\n                        }\r\n                        \r\n                        const pBase = 40; \r\n                        const pRest = 60;\r\n                        const current = i * event.moments.length + m;\r\n                        const total = totalEvents * 3; \r\n                        document.getElementById('global-progress').style.width = `${pBase + ((current/total)*pRest)}%`;\r\n                    }\r\n                    await fs.save();\r\n                }\r\n            },\r\n\r\n            async generateProse(moment, context) {\r\n                const prompt = `\r\n                ESTILO: Novela literaria de alta calidad.\r\n                CONTEXTO GLOBAL: ${context}\r\n                LO QUE ACABA DE PASAR: ...${this.state.contextBuffer.slice(-300)}\r\n                MOMENTO A ESCRIBIR: \"${moment}\"\r\n                INSTRUCCIÓN: Escribe 2-3 párrafos inmersivos. Muestra, no cuentes. Enfócate en sensaciones y psicología.\r\n                `;\r\n                return await this.aiCall(\"Writer\", prompt, 'gemini');\r\n            },\r\n\r\n            async illustrate(moment, text) {\r\n                const mentioned = this.state.database.filter(d => text.includes(d.name));\r\n                const visualContext = mentioned.map(d => `${d.name} looks like: ${d.visualDesc}`).join(\". \");\r\n                \r\n                const promptRaw = `\r\n                SCENE: ${moment}\r\n                VISUAL CONTEXT: ${visualContext}\r\n                STYLE: ${this.state.config.visual}\r\n                TASK: Write a FLUX image prompt (English).\r\n                `;\r\n                const finalPrompt = await this.aiCall(\"Prompter\", promptRaw, 'gemini-fast');\r\n                \r\n                try {\r\n                    const url = await this.imgCall(finalPrompt);\r\n                    const html = `<div class=\"book-img-wrapper\"><img src=\"${url}\" class=\"book-img\"></div>`;\r\n                    ui.appendBookContent(html);\r\n                    fs.updateBook(this.state.bookId, html);\r\n                } catch(e) { console.error(\"Img fail\", e); }\r\n            }\r\n        };\r\n\r\n        auth.init();\r\n        window.engine = engine; window.ui = ui;\r\n    </script>\r\n</body>\r\n</html>",
  "parentId": "folder-1768592290969-689605",
  "x": 485,
  "y": 442,
  "icon": "layout",
  "color": "text-orange-500"
}
     ;

    /**
     * REDEFINICIÓN DE TOGGLELAUNCHER (A)
     * Ejecución directa de la Materia en una Ventana del Sistema (HTML).
     */
    function injectProLauncher() {
        console.log("B -> Resonancia focalizada en Ventana de Procedimiento.");

        window.toggleLauncher = async function() {
            // ID consistente para evitar múltiples ventanas
            const winId = 'procedimiento-nexus-window';
            const existingWindow = document.getElementById(`window-${winId}`);

            // 1. Si ya existe, solo la enfocamos
            if (existingWindow) {
                if (typeof focusWindow === 'function') focusWindow(winId);
                return;
            }

            // 2. Preparar Z-Index (asumiendo variable global del sistema)
            if (typeof zIndexCounter !== 'undefined') zIndexCounter++;
            const currentZ = (typeof zIndexCounter !== 'undefined') ? zIndexCounter : 100;

            // 3. Definir la ventana (Tipo HTML para borde naranja)
            const winObj = {
                id: winId,
                type: 'html', 
                title: "PROCEDIMIENTO (Nexus + OmniGen + Flux)",
                icon: 'layout', // Icono visual
                color: 'text-orange-500',
                width: 1100,
                height: 800,
                x: 60,
                y: 40,
                zIndex: currentZ,
                isMinimized: false,
                isMaximized: false
            };

            // 4. Registrar en el gestor de ventanas (si es accesible)
            if (typeof openWindows !== 'undefined') openWindows.push(winObj);

            // 5. Crear el DOM de la ventana
            if (typeof createWindowDOM === 'function') {
                createWindowDOM(winObj, winObj);
            } else {
                console.error("Error: createWindowDOM no está disponible.");
                return;
            }

            // 6. Inyectar el contenido HTML en un Iframe (Sandbox seguro)
            setTimeout(() => {
                const winEl = document.getElementById(`window-${winId}`);
                if (winEl) {
                    const contentArea = winEl.querySelector('.content-area');
                    if (contentArea) {
                        contentArea.innerHTML = ''; // Limpiar loader
                        
                        const iframe = document.createElement('iframe');
                        iframe.style.width = '100%';
                        iframe.style.height = '100%';
                        iframe.style.border = 'none';
                        iframe.style.backgroundColor = '#0f172a'; // Fondo oscuro para evitar flash blanco
                        
                        contentArea.appendChild(iframe);
                        
                        // Escribir el contenido
                        const doc = iframe.contentWindow.document;
                        doc.open();
                        doc.write(APP_PRO_DATA.content);
                        doc.close();
                    }
                }
            }, 50);
        };
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', injectProLauncher);
    } else {
        setTimeout(injectProLauncher, 100);
    }

    console.log("H -> Lógica del Ojo reconfigurada para Ventana HTML.");
})();