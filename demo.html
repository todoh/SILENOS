<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Análisis Narrativo - Prototipo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Scribe's Desk -->
    <!-- Application Structure Plan: Se ha diseñado una SPA con un enfoque de panel de control (dashboard). La navegación principal permite al usuario cambiar entre vistas clave identificadas en el informe: un "Workspace" general, una vista para explorar "Entidades" (personajes, lugares), un "Grafo de Relaciones", una "Línea de Tiempo" y un "Módulo de Análisis". Esta estructura fue elegida porque traduce directamente la funcionalidad modular descrita en el informe a una experiencia de usuario tangible, permitiendo una exploración no lineal. El usuario puede empezar con una vista general (Workspace), profundizar en detalles específicos (Entidades), o analizar la estructura global (Grafo, Línea de Tiempo), lo que maximiza la usabilidad y la comprensión del potencial de la herramienta. -->
    <!-- Visualization & Content Choices: 
        - Resumen General (Workspace): Objetivo: Informar. Método: Tarjetas de estadísticas (HTML/Tailwind) y un gráfico de Donut (Chart.js) para mostrar la distribución de entidades. Interacción: Estático, vista rápida. Justificación: Proporciona un resumen cuantitativo inmediato del contenido de la narrativa, tal como lo haría un panel de control real.
        - Explorador de Entidades: Objetivo: Organizar/Informar. Método: Lista interactiva (HTML/JS) que puebla una tarjeta de detalles. Interacción: Clic. Justificación: Simula cómo un usuario navegaría y accedería a la información detallada de cada elemento de la historia.
        - Grafo de Relaciones: Objetivo: Mostrar Relaciones. Método: Gráfico de Burbujas (Chart.js) para simular un grafo de red. Interacción: Hover para Tooltips, botones para filtrar por tipo de entidad. Justificación: Ante la restricción de no usar librerías de grafos ni SVG, el gráfico de burbujas es una solución creativa que representa nodos y conexiones de forma visual e interactiva.
        - Línea de Tiempo: Objetivo: Mostrar Cambio. Método: Diagrama de flujo horizontal (HTML/Tailwind/JS). Interacción: Clic para resaltar y ver detalles. Justificación: Es una forma clara y efectiva de visualizar secuencias de eventos sin librerías adicionales.
        - Análisis de Ritmo: Objetivo: Comparar. Método: Gráfico de Barras (Chart.js). Interacción: Hover para detalles. Justificación: Traduce el concepto abstracto de "ritmo narrativo" a una visualización cuantitativa y fácil de interpretar.
        - Detector de Inconsistencias: Objetivo: Informar. Método: Lista estilizada de alertas (HTML/Tailwind). Interacción: Estático. Justificación: Muestra de forma directa la capacidad de análisis proactivo del sistema.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
        @media (max-width: 768px) { .chart-container { height: 300px; max-height: 60vh; } }
        .view { display: none; }
        .view.active { display: block; }
        .nav-btn { transition: all 0.2s ease-in-out; }
        .nav-btn.active { background-color: #A8A29E; color: white; }
        .nav-btn:not(.active):hover { background-color: #E7E5E4; }
        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            height: 4px;
            background-color: #D6D3D1;
        }
        .timeline-item { position: relative; }
        .timeline-dot {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: white;
            border: 4px solid #A8A29E;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .timeline-item:hover .timeline-dot { transform: translate(-50%, -50%) scale(1.2); border-color: #78716C; }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div id="app" class="min-h-screen flex flex-col">
        <header class="bg-white shadow-md sticky top-0 z-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <h1 class="text-xl sm:text-2xl font-bold text-stone-700">Sistema de Análisis Narrativo</h1>
                    <nav id="main-nav" class="hidden md:flex items-center space-x-2">
                        <button data-view="workspace" class="nav-btn active px-3 py-2 rounded-md text-sm font-medium">Workspace</button>
                        <button data-view="entities" class="nav-btn px-3 py-2 rounded-md text-sm font-medium">Entidades</button>
                        <button data-view="graph" class="nav-btn px-3 py-2 rounded-md text-sm font-medium">Grafo</button>
                        <button data-view="timeline" class="nav-btn px-3 py-2 rounded-md text-sm font-medium">Línea de Tiempo</button>
                        <button data-view="analysis" class="nav-btn px-3 py-2 rounded-md text-sm font-medium">Análisis</button>
                    </nav>
                    <div class="md:hidden">
                        <select id="mobile-nav" class="bg-stone-200 border border-stone-300 rounded-md p-2">
                            <option value="workspace">Workspace</option>
                            <option value="entities">Entidades</option>
                            <option value="graph">Grafo</option>
                            <option value="timeline">Línea de Tiempo</option>
                            <option value="analysis">Análisis</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            
            <div id="workspace-view" class="view active animate-fade-in">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-stone-800 mb-2">Workspace del Analista</h2>
                    <p class="text-stone-600 max-w-3xl mx-auto">Esta es una vista general de su narrativa. El workspace combina métricas clave y visualizaciones para ofrecer un resumen instantáneo del estado de su mundo, permitiéndole identificar rápidamente el balance de su contenido.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-stone-500 text-sm font-medium">Personajes</h3><p id="stat-personajes" class="text-3xl font-semibold mt-1">0</p></div>
                    <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-stone-500 text-sm font-medium">Ubicaciones</h3><p id="stat-ubicaciones" class="text-3xl font-semibold mt-1">0</p></div>
                    <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-stone-500 text-sm font-medium">Eventos</h3><p id="stat-eventos" class="text-3xl font-semibold mt-1">0</p></div>
                    <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-stone-500 text-sm font-medium">Objetos</h3><p id="stat-objetos" class="text-3xl font-semibold mt-1">0</p></div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4">Distribución de Entidades</h3>
                    <p class="text-stone-600 mb-4 max-w-3xl">Este gráfico muestra la proporción de cada tipo de entidad en su base de datos. Es útil para ver si su narrativa está balanceada o si se concentra más en personajes, eventos, etc.</p>
                    <div class="chart-container">
                        <canvas id="entityDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="entities-view" class="view">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-stone-800 mb-2">Explorador de Entidades</h2>
                    <p class="text-stone-600 max-w-3xl mx-auto">Navegue, cree y edite todos los elementos de su mundo. Seleccione una categoría para ver el listado y haga clic en un elemento para ver su ficha de detalles completa, incluyendo sus atributos y relaciones.</p>
                </div>
                 <div class="flex space-x-2 mb-6 border-b-2 border-stone-200">
                    <button class="entity-type-btn active py-2 px-4 font-semibold" data-type="personajes">Personajes</button>
                    <button class="entity-type-btn py-2 px-4 font-semibold" data-type="ubicaciones">Ubicaciones</button>
                    <button class="entity-type-btn py-2 px-4 font-semibold" data-type="eventos">Eventos</button>
                    <button class="entity-type-btn py-2 px-4 font-semibold" data-type="objetos">Objetos</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div id="entity-list" class="md:col-span-1 bg-white p-4 rounded-lg shadow h-full max-h-[60vh] overflow-y-auto">
                    </div>
                    <div id="entity-detail" class="md:col-span-2 bg-white p-6 rounded-lg shadow min-h-[300px]">
                        <p class="text-stone-500 text-center mt-10">Seleccione un elemento de la lista para ver sus detalles.</p>
                    </div>
                </div>
            </div>

            <div id="graph-view" class="view">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-stone-800 mb-2">Grafo de Relaciones</h2>
                    <p class="text-stone-600 max-w-3xl mx-auto">Esta visualización simula un grafo de red para mostrar la intrincada tela de conexiones entre todas las entidades. Cada burbuja es una entidad. Pase el cursor para ver detalles y use los filtros para analizar subconjuntos específicos de la red.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-center space-x-2 mb-4">
                        <button class="graph-filter-btn active" data-filter="all">Todos</button>
                        <button class="graph-filter-btn" data-filter="personajes">Personajes</button>
                        <button class="graph-filter-btn" data-filter="eventos">Eventos</button>
                        <button class="graph-filter-btn" data-filter="ubicaciones">Ubicaciones</button>
                        <button class="graph-filter-btn" data-filter="objetos">Objetos</button>
                    </div>
                    <div class="chart-container">
                        <canvas id="relationsGraphChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="timeline-view" class="view">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-stone-800 mb-2">Línea de Tiempo Narrativa</h2>
                    <p class="text-stone-600 max-w-3xl mx-auto">Visualice la secuencia cronológica de los eventos clave en su historia. Esto ayuda a comprender el flujo de la trama, identificar el ritmo y asegurar la coherencia temporal. Haga clic en un evento para resaltar sus detalles.</p>
                </div>
                <div class="bg-white p-8 rounded-lg shadow">
                    <div id="timeline-container" class="relative py-8">
                        <div class="timeline grid grid-cols-1 sm:grid-cols-3 gap-x-8 gap-y-16">
                        </div>
                    </div>
                    <div id="timeline-details" class="mt-8 p-4 bg-stone-50 rounded-lg border border-stone-200 text-center min-h-[50px]">
                        <p class="text-stone-500">Haga clic en un evento para ver su descripción aquí.</p>
                    </div>
                </div>
            </div>

            <div id="analysis-view" class="view">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-stone-800 mb-2">Módulo de Análisis Inteligente</h2>
                    <p class="text-stone-600 max-w-3xl mx-auto">Este módulo demuestra la capacidad proactiva del sistema. Analiza su base de datos para detectar inconsistencias, analizar patrones temáticos y sugerir oportunidades narrativas que de otro modo podrían pasar desapercibidas.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Detector de Inconsistencias</h3>
                        <p class="text-stone-600 mb-4">Alertas automáticas sobre posibles errores lógicos o de continuidad en la trama.</p>
                        <ul class="space-y-3">
                            <li class="flex items-start p-3 bg-red-50 border border-red-200 rounded-md"><span class="text-red-500 font-bold mr-3">ALERTA:</span><span class="text-sm">Conflicto temporal: <strong>Kael</strong> aparece en la 'Torre Sombría' y en 'Aethelgard' en la misma fecha (Año 345, Estación de la Cosecha).</span></li>
                            <li class="flex items-start p-3 bg-yellow-50 border border-yellow-200 rounded-md"><span class="text-yellow-600 font-bold mr-3">AVISO:</span><span class="text-sm">Agujero de trama potencial: El 'Amuleto de Sol' se describe como destruido en 'La Emboscada', pero <strong>Elara</strong> lo utiliza posteriormente en 'La Revelación'.</span></li>
                            <li class="flex items-start p-3 bg-blue-50 border border-blue-200 rounded-md"><span class="text-blue-500 font-bold mr-3">SUGERENCIA:</span><span class="text-sm">Lógica de conocimiento: <strong>Seraphina</strong> no debería conocer los detalles de 'La Emboscada', ya que no estuvo presente y no ha interactuado con ningún testigo.</span></li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Análisis de Ritmo Narrativo</h3>
                        <p class="text-stone-600 mb-4">Frecuencia de eventos de alta tensión frente a desarrollo de personajes para evaluar el ritmo general.</p>
                        <div class="chart-container" style="height: 250px; max-height: 40vh;">
                            <canvas id="pacingChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mockData = {
                personajes: [
                    { id: 'p1', nombre: 'Elara', rol: 'Protagonista', descripcion: 'Una joven valiente con un destino misterioso.' },
                    { id: 'p2', nombre: 'Kael', rol: 'Antagonista', descripcion: 'Un guerrero sombrío que busca poder a cualquier costo.' },
                    { id: 'p3', nombre: 'Seraphina', rol: 'Mentora', descripcion: 'Una sabia anciana que guía a Elara en su viaje.' },
                ],
                ubicaciones: [
                    { id: 'u1', nombre: 'Aethelgard', tipo: 'Capital', descripcion: 'La ciudad principal del reino, llena de intrigas políticas.' },
                    { id: 'u2', nombre: 'Bosques Susurrantes', tipo: 'Bosque', descripcion: 'Un antiguo bosque con secretos ocultos.' },
                    { id: 'u3', nombre: 'Torre Sombría', tipo: 'Fortaleza', descripcion: 'La base de operaciones de Kael.' },
                ],
                eventos: [
                    { id: 'e1', nombre: 'La Coronación', fecha: 'Año 345, Estación de la Siembra', tipo: 'Desarrollo', descripcion: 'Un evento político clave en Aethelgard.' },
                    { id: 'e2', nombre: 'La Emboscada', fecha: 'Año 345, Estación de la Cosecha', tipo: 'Alta Tensión', descripcion: 'Kael ataca a Elara en los Bosques Susurrantes.' },
                    { id: 'e3', nombre: 'La Revelación', fecha: 'Año 346, Primera Nevada', tipo: 'Alta Tensión', descripcion: 'Seraphina revela el verdadero origen de Elara.' },
                ],
                objetos: [
                    { id: 'o1', nombre: 'Amuleto de Sol', tipo: 'Joya Mágica', descripcion: 'Una reliquia antigua que protege a su portador.' },
                    { id: 'o2', nombre: 'Hoja Sombría', tipo: 'Arma', descripcion: 'La espada de Kael, forjada con magia oscura.' },
                ],
                relaciones: [
                    { source: 'p1', target: 'u1', label: 'reside en' }, { source: 'p1', target: 'e1', label: 'asistió a' },
                    { source: 'p1', target: 'e2', label: 'fue víctima en' }, { source: 'p1', target: 'e3', label: 'descubrió su pasado en' },
                    { source: 'p1', target: 'o1', label: 'posee' }, { source: 'p1', target: 'p2', label: 'es enemiga de' },
                    { source: 'p1', target: 'p3', label: 'es aprendiz de' }, { source: 'p2', target: 'u3', label: 'opera desde' },
                    { source: 'p2', target: 'e2', label: 'perpetró' }, { source: 'p2', target: 'o2', label: 'blande' },
                    { source: 'p3', target: 'e3', label: 'reveló secreto en' }, { source: 'e1', target: 'u1', label: 'ocurrió en' },
                    { source: 'e2', target: 'u2', label: 'ocurrió en' }, { source: 'e2', target: 'o1', label: 'fue dañado durante'},
                ]
            };

            const allEntities = [
                ...mockData.personajes.map(e => ({...e, type: 'personajes'})),
                ...mockData.ubicaciones.map(e => ({...e, type: 'ubicaciones'})),
                ...mockData.eventos.map(e => ({...e, type: 'eventos'})),
                ...mockData.objetos.map(e => ({...e, type: 'objetos'}))
            ];

            const state = {
                currentView: 'workspace',
                currentEntityType: 'personajes',
                charts: {}
            };

            const views = {
                workspace: document.getElementById('workspace-view'),
                entities: document.getElementById('entities-view'),
                graph: document.getElementById('graph-view'),
                timeline: document.getElementById('timeline-view'),
                analysis: document.getElementById('analysis-view'),
            };
            
            function findEntity(id) {
                return allEntities.find(e => e.id === id);
            }

            function renderView() {
                Object.values(views).forEach(v => v.classList.remove('active'));
                views[state.currentView].classList.add('active');
                
                const navButtons = document.querySelectorAll('#main-nav .nav-btn');
                navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === state.currentView);
                });

                document.getElementById('mobile-nav').value = state.currentView;

                switch(state.currentView) {
                    case 'workspace': initWorkspaceView(); break;
                    case 'entities': initEntitiesView(); break;
                    case 'graph': initGraphView(); break;
                    case 'timeline': initTimelineView(); break;
                    case 'analysis': initAnalysisView(); break;
                }
            }

            function initWorkspaceView() {
                document.getElementById('stat-personajes').textContent = mockData.personajes.length;
                document.getElementById('stat-ubicaciones').textContent = mockData.ubicaciones.length;
                document.getElementById('stat-eventos').textContent = mockData.eventos.length;
                document.getElementById('stat-objetos').textContent = mockData.objetos.length;
                
                if (!state.charts.entityDistribution) {
                    const ctx = document.getElementById('entityDistributionChart').getContext('2d');
                    state.charts.entityDistribution = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Personajes', 'Ubicaciones', 'Eventos', 'Objetos'],
                            datasets: [{
                                data: [
                                    mockData.personajes.length,
                                    mockData.ubicaciones.length,
                                    mockData.eventos.length,
                                    mockData.objetos.length,
                                ],
                                backgroundColor: ['#FCA5A5', '#FCD34D', '#93C5FD', '#A78BFA'],
                                borderColor: '#F5F5DC',
                                borderWidth: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'right' }
                            }
                        }
                    });
                }
            }

            function initEntitiesView() {
                renderEntityList();
                const entityTypeButtons = document.querySelectorAll('.entity-type-btn');
                entityTypeButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.type === state.currentEntityType);
                    btn.onclick = (e) => {
                        state.currentEntityType = e.target.dataset.type;
                        document.getElementById('entity-detail').innerHTML = `<p class="text-stone-500 text-center mt-10">Seleccione un elemento de la lista para ver sus detalles.</p>`;
                        renderEntityList();
                         entityTypeButtons.forEach(b => b.classList.remove('active'));
                         e.target.classList.add('active');
                    };
                });
            }

            function renderEntityList() {
                const listContainer = document.getElementById('entity-list');
                const items = mockData[state.currentEntityType];
                listContainer.innerHTML = items.map(item => `
                    <div class="p-3 rounded-md hover:bg-stone-100 cursor-pointer entity-list-item" data-id="${item.id}">
                        <h4 class="font-semibold">${item.nombre}</h4>
                        <p class="text-sm text-stone-500">${item.rol || item.tipo}</p>
                    </div>
                `).join('');

                document.querySelectorAll('.entity-list-item').forEach(item => {
                    item.onclick = (e) => {
                        const id = e.currentTarget.dataset.id;
                        renderEntityDetail(id);
                    }
                });
            }

            function renderEntityDetail(id) {
                const entity = findEntity(id);
                if (!entity) return;

                const detailContainer = document.getElementById('entity-detail');
                const entityRelations = mockData.relaciones.filter(r => r.source === id || r.target === id);
                
                detailContainer.innerHTML = `
                    <h3 class="text-2xl font-bold mb-2">${entity.nombre}</h3>
                    <p class="text-stone-500 font-semibold mb-4">${entity.rol || entity.tipo}</p>
                    <p class="mb-6">${entity.descripcion}</p>
                    <h4 class="font-semibold mb-2 border-t border-stone-200 pt-4">Relaciones:</h4>
                    ${entityRelations.length > 0 ? `
                        <ul class="list-disc list-inside space-y-1 text-sm">
                            ${entityRelations.map(r => {
                                const otherEntityId = r.source === id ? r.target : r.source;
                                const otherEntity = findEntity(otherEntityId);
                                const relationText = r.source === id ? `${r.label} <strong>${otherEntity.nombre}</strong>` : `es ${r.label} por <strong>${otherEntity.nombre}</strong>`;
                                return `<li>${relationText}</li>`;
                            }).join('')}
                        </ul>
                    ` : '<p class="text-sm text-stone-500">Sin relaciones directas.</p>' }
                `;
            }

            function initGraphView() {
                const filterButtons = document.querySelectorAll('.graph-filter-btn');
                filterButtons.forEach(btn => {
                    btn.onclick = e => {
                        filterButtons.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        updateGraphData(e.target.dataset.filter);
                    }
                });
                updateGraphData('all');
            }

            function updateGraphData(filter) {
                const filteredEntities = filter === 'all' ? allEntities : allEntities.filter(e => e.type === filter);
                
                const data = {
                    datasets: filteredEntities.map(entity => {
                        const colors = {
                            personajes: 'rgba(252, 165, 165, 0.7)',
                            ubicaciones: 'rgba(252, 211, 77, 0.7)',
                            eventos: 'rgba(147, 197, 253, 0.7)',
                            objetos: 'rgba(167, 139, 250, 0.7)'
                        };
                        return {
                            label: entity.nombre,
                            data: [{
                                x: Math.random() * 100,
                                y: Math.random() * 100,
                                r: (mockData.relaciones.filter(r => r.source === entity.id || r.target === entity.id).length * 5) + 5
                            }],
                            backgroundColor: colors[entity.type],
                            entityType: entity.type
                        };
                    })
                };

                if (state.charts.relationsGraph) {
                    state.charts.relationsGraph.data = data;
                    state.charts.relationsGraph.update();
                } else {
                     const ctx = document.getElementById('relationsGraphChart').getContext('2d');
                     state.charts.relationsGraph = new Chart(ctx, {
                        type: 'bubble',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: { display: false },
                                y: { display: false }
                            }
                        }
                    });
                }
            }
            
            function initTimelineView() {
                const container = document.getElementById('timeline-container');
                const details = document.getElementById('timeline-details');
                container.querySelector('.grid').innerHTML = mockData.eventos
                    .sort((a,b) => new Date(a.fecha.replace('Año ', '').replace(/, Estación de la |Primera /g, ' ')) - new Date(b.fecha.replace('Año ', '').replace(/, Estación de la |Primera /g, ' ')))
                    .map(evento => `
                    <div class="timeline-item flex flex-col items-center cursor-pointer p-4" data-id="${evento.id}">
                        <div class="timeline-dot"></div>
                        <h4 class="font-bold text-center mt-8">${evento.nombre}</h4>
                        <p class="text-sm text-stone-500 text-center">${evento.fecha}</p>
                    </div>
                `).join('');

                container.querySelectorAll('.timeline-item').forEach(item => {
                    item.onclick = e => {
                        const eventId = e.currentTarget.dataset.id;
                        const evento = mockData.eventos.find(ev => ev.id === eventId);
                        details.innerHTML = `<p><strong>${evento.nombre}:</strong> ${evento.descripcion}</p>`;
                    }
                });
            }

            function initAnalysisView() {
                if(!state.charts.pacingChart) {
                    const ctx = document.getElementById('pacingChart').getContext('2d');
                    const pacingData = mockData.eventos.reduce((acc, event) => {
                        acc[event.tipo] = (acc[event.tipo] || 0) + 1;
                        return acc;
                    }, {});

                    state.charts.pacingChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Alta Tensión', 'Desarrollo'],
                            datasets: [{
                                label: 'Número de Eventos',
                                data: [pacingData['Alta Tensión'] || 0, pacingData['Desarrollo'] || 0],
                                backgroundColor: ['rgba(239, 68, 68, 0.6)', 'rgba(59, 130, 246, 0.6)'],
                                borderColor: ['rgba(239, 68, 68, 1)', 'rgba(59, 130, 246, 1)'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                        }
                    });
                }
            }


            const mainNavButtons = document.querySelectorAll('#main-nav .nav-btn');
            mainNavButtons.forEach(btn => {
                btn.onclick = e => {
                    state.currentView = e.target.dataset.view;
                    renderView();
                }
            });

            document.getElementById('mobile-nav').onchange = e => {
                state.currentView = e.target.value;
                renderView();
            };

            renderView();
        });
    </script>
</body>
</html>
