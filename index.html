<!DOCTYPE html>
<html lang="es">
<head>  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Silenos Versi√≥n 1.1.8</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="momentos.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚úíÔ∏è</text></svg>">

</head>
<body>

<div id="opciones" >
<h2 id="titulo-proyecto" contenteditable="true" placeholder="Escribe el t√≠tulo del proyecto">Silenos Versi√≥n 1.1.8</h2>
<div id="menu" >        
   
    <button  onclick="cerrartodo(), gridear('personajes'),agregarBotonEliminarAPersonajes();">Datos</button>
    <button  onclick="cerrartodo(), abrir('momentos');">Momentos</button>
    <button  onclick="cerrartodo(), abrir('capitulosh');">Capitulos</button>
    <button  onclick="cerrartodo(), abrir('escenah');">Escenas</button>
    <button  onclick="cerrartodo(), abrirGuion();">Guion</button> 
    <button  onclick="cerrartodo(), abrir('ia');">IA</button>

    <button class="pro" onclick="reiniciar()"> üÜï </button>
    <button class="pro" onclick="abrirModalExportar()">üíΩ Export</button>
    <button class="pro" onclick="guardarJSON()">üíæ Save</button>
    <input type="file" id="file-load" accept="application/json"  onchange="cargarJSON(event)" style="display: none;">
    <button class="pro" onclick="document.getElementById('file-load').click()">üóÇÔ∏è Load</button>
    <button class="pro" onclick="abrirModalConfig()"> ‚öôÔ∏è </button>
    <button class="pro" style="display: none;" id="import-data-button" onclick="abrirModalImportar()">üì•</button>
    <button class="pro" id="theme-toggle-button" onclick="toggleTheme()">üåô</button>
</div></div>

<div id="momentos">
    <!-- Controles flotantes para la secci√≥n de momentos -->
    <div id="momentos-controles-flotantes">
        <button class="pro" id="agregar-momento-btn">A√±adir Momento</button>
        <div id="momentos-controles-ia">      
            <button class="pro" id="generar-aventura-ia-btn" title="Usa la IA para generar una aventura interactiva completa a partir del guion seleccionado.">Generar Aventura con IA ‚ú®</button>
            <select id="guion-select" class="pro" title="Selecciona un guion para usar como base para la IA"></select>
            
            <!-- INICIO DE LA MODIFICACI√ìN -->
            <input type="number" id="ia-call-budget-input" class="pro ia-input-numero" min="5" max="100" value="15" title="Presupuesto de Llamadas a la IA. Define el n√∫mero m√°ximo de peticiones para crear y expandir ramas en la historia. Un n√∫mero m√°s alto crea una aventura m√°s grande y compleja.">
            <!-- FIN DE LA MODIFICACI√ìN -->
        </div>
    </div>

    <div id="momentos-lienzo">
        <!-- Los nodos de momento se agregar√°n aqu√≠ din√°micamente -->
    </div>
</div>


<div id="guion-literario">
    <!-- Barra de herramientas para los botones de acci√≥n -->
    <div id="guion-toolbar">
        <button class="pro" id="sumar-capitulo-guion" onclick="agregarCapituloYMostrar()">Agregar Cap√≠tulo</button>
        <!-- Los botones din√°micos de IA se insertar√°n aqu√≠ -->
    </div>
    <!-- Layout principal del guion -->
    <div id="guion-layout">
        <div id="indice-capitulos-guion">
            <!-- La lista de cap√≠tulos va aqu√≠ -->
        </div>
        <div id="contenido-capitulo-activo">
            <!-- El editor del cap√≠tulo seleccionado va aqu√≠ -->
        </div>
    </div>
</div>

<div id="ia" >
    <div id="creasion" >
        <button class="pro" onclick="cerrartodo(), abrir('capitulosh'), actualizarParametrosIA(), crearEscenasAutomaticamente(nombredelahistoria, cantidaddeescenas, cantidadframes);">Insertar Cap√≠tulos vac√≠os en la Historia</button>
        <input type="text" id="nombrehistoria" placeholder="Nombre de las Escenas" value="Nombre de la Historia">
        <input type="number" id="cantidadescenas" placeholder= "Cantidad de Escenas" value="2">
        <input type="number" id="cantidadeframes" placeholder= "Cantidad de Frames" value="3">
    </div>

    <textarea id="gemini1"  placeholder="Escribe tu Historia..."></textarea>
    
    <div id="chateo" >
        <div id="ia-options">
            <input type="checkbox" id="incluir-datos-ia" checked>
            <label for="incluir-datos-ia">Usar Datos ya Guardados en la generaci√≥n de la Historia</label>
        </div>
        <div id="ia-buttons">
            <button id="enviargemini"  class="pro" onclick="actualizarParametrosIA(), enviarTextoConInstrucciones()">Generar Historia</button>
            <button id="enviargemini-desarrollar"  class="pro" onclick="actualizarParametrosIA(), desarrollarFramesDesdeGeminimente(nombredelahistoria); cerrartodo(); abrir('capitulosh');">Insertar Frames en la Historia</button>
        </div>
    </div>

    <div id="geminimente"></div> 
</div>


<div id="editor">
      <p></p>
      <p></p>
      <p></p>
<div id="chat"></div>
<button onclick="herramientacopiar()"> üì• </button><div id="herramienta" ></div>
<textarea id="user-input" placeholder="Escribe tu mensaje..."></textarea>
<button id="enviar" onclick="enviartexto()">Enviar</button>
<div id="modos" ></div></div>

<div id="escenah">
    <div class="escena-toolbar">
        <button id="crear-escena-btn">Nueva Escena</button>
        <select id="escenas-dropdown"></select>
        <input type="text" id="escena-nombre-input" placeholder="Nombre de la Escena...">
        <button id="agregar-toma-btn">A√±adir Toma (8s)</button>
    </div>
    <div id="tomas-timeline">
        </div>
</div>


<div id="capitulosh"  >
<button class="pro" id="sumarpersonaje" onclick="nuevaEscena()">Agregar Cap√≠tulo</button>
<div id="capitulos" >
<div id="lista-capitulos"></div></div></div>

<div id="personajes">
    <div id="datos-botones-superiores">
        <button class="pro" id="sumarpersonaje" onclick="agregarPersonaje()">Agregar Dato</button>
        <button class="pro" id="sumarpersonaje-ia" onclick="abrirModalAIDatos()">A√±adir Datos con IA ‚ú®</button>
    </div>
    <div id="listapersonajes"></div>
</div>

<div id="escena-vista">
    <textarea id="escena-texto" placeholder="Texto de la escena"></textarea>
    <div id="drop-zone"   >
        <img id="imagen-preview" alt="Vista previa de la imagen">
    <input type="file" id="file-input" accept="image/*, video/mp4, video/webm, image/gif"  style="display: none;" ></div>
<div id="botonesss"   >
    <button class="botoness" onclick="agregarBoton('transicion')">+ Bot√≥n de Transici√≥n</button>
    <button class="botoness" onclick="agregarBoton('accion')">+ Bot√≥n de Acci√≥n</button></div>
<div class="lista" > <div id="botones-lista"></div></div>
</div>
<video id="hiddenVideoPlayer" style="display:none;"></video>
<canvas id="hiddenCanvas" style="display:none;"></canvas>
 
<div id="modal-overlay"></div>

<div id="lugares" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalConfig()">&times;</button>
    <p>Para utilizar la inteligencia artificial de Silenos necesita:</p>
    <p>Una API KEY de GOOGLE, puede obtenerla aqu√≠:</p>
    <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer"  style="padding: 10px 20px; background-color: rgb(0, 0, 0); color: white; text-decoration: none; border-radius: 5px;">
     AI Studio de Google.com
    </a><p></p>
    <input type="text" id="apiInput" placeholder="Ingresa tu API Key">
    <button onclick="updateApiKey()">Actualizar</button>
    <p>API Key actual: <span id="apiKeyDisplay">[No definida]</span></p> 
</div>

<div id="modal-importar-json" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalImportar()">&times;</button>
    <h3>Importar Datos desde JSON</h3>
    <p>Pega el contenido de un √∫nico objeto JSON (un dato, cap√≠tulo, etc.) en el siguiente campo.</p>
    <textarea id="json-import-area" placeholder='Ejemplo para un "Dato":\n{\n  "nombre": "Espada Legendaria",\n  "descripcion": "Forjada por los dioses.",\n  "etiqueta": "objeto",\n  "imagen": ""\n}'></textarea>
    <button class="modal-button" onclick="importarDatosDesdeJSON()">A√±adir Datos</button>
</div>

<!-- Modal para A√±adir Datos con IA -->
<div id="modal-ia-datos" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalAIDatos()">&times;</button>
    <h3>A√±adir Datos con Inteligencia Artificial</h3>
    <p>Pega aqu√≠ el nombre de una obra (ej: "Star Wars"), una lista de ideas, o un JSON para que la IA los procese y a√±ada como datos estructurados.</p>
    <textarea id="ia-datos-area" placeholder='Ejemplo 1: El Se√±or de los Anillos

Ejemplo 2: Un caballero valiente llamado Arthur, su espada m√°gica Excalibur, el reino de Camelot.

Ejemplo 3: [{"nombre": "Dato 1", "descripcion": "..."}]'></textarea>
    <button class="modal-button" onclick="procesarEntradaConIA()">‚ú® Analizar y Agregar Datos</button>
</div>


<!-- Modal para Editar Momentos -->
<div id="modal-editar-momento" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalEditarMomento()">&times;</button>
    <h3>Editar Momento</h3>
    <input type="text" id="momento-editor-titulo" placeholder="T√≠tulo del Momento">
    <textarea id="momento-editor-descripcion" placeholder="Descripci√≥n..."></textarea>
    <div id="momento-editor-drop-zone" class="drop-zone-estilo">
        Arrastra una imagen aqu√≠ o haz clic para seleccionarla
        <img id="momento-editor-imagen-preview" alt="Vista previa">
        <input type="file" id="momento-editor-file-input" accept="image/*" style="display: none;">
    </div>

    <!-- Contenedor para las acciones din√°micas -->
    <div id="acciones-container"></div>

    <!-- Contenedor para los botones del modal -->
    <div class="modal-buttons-container">
        <button id="boton-agregar-accion" class="modal-button">A√±adir Acci√≥n</button>
        <button class="modal-button" onclick="guardarCambiosMomento()">Guardar Cambios</button>
    </div>
</div>

<!-- Modal para Exportar -->
<div id="modal-exportar" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalExportar()">&times;</button>
    <h3>Opciones de Exportaci√≥n</h3>
    
    <div class="export-option">
        <h4>Exportar Guion</h4>
        <p>Exporta los cap√≠tulos y sus frames a un archivo HTML simple.</p>
        <button class="modal-button" onclick="generarHTML()">Exportar Guion HTML</button>
    </div>
   <!-- INICIO: Nueva Opci√≥n de Exportaci√≥n -->
    <div class="export-option">
        <h4>Exportar Storyboard de Tomas</h4>
        <p>Exporta las escenas de storyboard (im√°genes y texto) a un archivo HTML.</p>

         <div class="export-controls">
             <select id="tomas-export-select" class="modal-select"></select>
             <button class="modal-button" onclick="generarHTMLTomas()">Exportar Tomas HTML</button>
        </div>    </div>
    <!-- FIN: Nueva Opci√≥n de Exportaci√≥n -->

    <div class="export-option">
        <h4>Exportar Videojuego</h4>
        <p>Exporta los momentos como una experiencia interactiva.</p>
        <input type="text" id="momento-inicial-id" placeholder="Nombre exacto del primer momento...">
        <button class="modal-button" onclick="iniciarExportacionJuego()">Exportar Videojuego HTML</button>
    </div>
</div>

<script src="gestionEscenas.js"></script>
<script src="momentos.js"></script>
<script src="guion.js"></script>
<script src="escenas.js"></script>
<script src="datos.js"></script>
<script src="io.js"></script>
<script src="gemini.js"></script>
<script src="geminialfa.js"></script>
<script src="geminivisual.js"></script> 
<script src="exportar.js"></script>
<script src="exportarjuego.js"></script>
<script src="exportartomas.js"></script>
<script src="main.js"></script> <!-- main.js se carga al final -->

</body>
</html>
