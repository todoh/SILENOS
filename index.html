<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Silenos Versi√≥n 1.1.10</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="styles2.css">
<link rel="stylesheet" href="clarooscuro.css">
<link rel="stylesheet" href="momentos.css">
<link rel="stylesheet" href="editor-momento.css">
<link rel="stylesheet" href="galeria.css">
<link rel="stylesheet" href="biblioteca.css">

<link rel="stylesheet" href="animacionessvg.css">

    
<style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
       
        .transition-all-ease { transition: all 0.3s ease-in-out; }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(22, 163, 74, 0);
            }
        }

        /* Estilos para el interruptor 2D/3D */
        .image-mode-toggle {
            display: flex;
            background-color: #333;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px; /* Espacio debajo del interruptor */
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            position: absolute; /* Posiciona el interruptor */
            top: 10px; /* Ajusta la posici√≥n superior */
            left: 10px; /* Ajusta la posici√≥n izquierda */
            z-index: 10; /* Asegura que est√© por encima de otros elementos */
        }

        .image-mode-toggle button {
            padding: 10px 15px;
            border: none;
            background-color: transparent;
            color: #bbb;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-grow: 1;
        }

        .image-mode-toggle button.active {
            background-color: #007bff; /* Color azul para el activo */
            color: white;
            font-weight: bold;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .image-mode-toggle button:hover:not(.active) {
            background-color: #555;
            color: white;
        }

        /* Asegura que los paneles de control tengan un posicionamiento relativo para el switch */
        #imagenes .container {
            position: relative;
            padding-top: 60px; /* Espacio para el interruptor */
        }
    </style>

    <link rel="stylesheet" href="escenas/styles.css">
 

<!-- Hoja de estilos para el nuevo editor de datos -->
<link rel="stylesheet" href="editor-personajes.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>S</text></svg>">
<link rel="stylesheet" href="asistente.css">

     <link rel="stylesheet" href="asistente.css">
<script src="https://unpkg.com/gifler@0.1.0/gifler.min.js"></script>




<script src="https://apis.google.com/js/api.js" async defer></script>
<script src="https://accounts.google.com/gsi/client" onload="gapiLoaded()" async defer></script>

<meta property="og:title" content="SILENOS Versi√≥n 1.1.10" />
<meta property="og:description" content="Editor de Historia con Inteligencia Artificial" />
<meta property="og:url" content="https://todoh.github.io/SILENOS" />
<meta property="og:image" content="https://raw.githubusercontent.com/todoh/SILENOS/refs/heads/main/silenos.png" />

<style>
    /* --- ESTILOS PARA EL MEN√ö DESPLEGABLE DEL ASISTENTE --- */
    #asistente-popup {
        position: absolute;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s;
        z-index: 9997;
    }
    
    #asistente-popup.visible {
        opacity: 1;
        visibility: visible;
    }

    #asistente-titulo-input {
        position: absolute;
        top: -15%;
        left: 50%; 
        width: 90%;
        padding: 10px 15px;
    height: 3%;
        font-size: 100%;
        background-color: #2c2c2c;
        color: white;
        border: 1px solid #666;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        transform: translateY(-10px) translateX(-50%);
        transition: transform 0.3s ease; z-index: 9998;
    }

    #asistente-popup.visible #asistente-titulo-input {
  
    }
    
    #asistente-menu {
        position: fixed;
        top: 50%; 
        right: 1%;
        width: 160px;
           background-color: transparent;
backdrop-filter: blur(20px);
background-image: linear-gradient(120deg, rgba(192, 192, 192, 0.3),  rgba(255, 255, 255, 0.2));




        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        gap: 8px; 
        padding: 10px;
        transform: translateY(-50%);

        transition: transform 0.3s ease;
    }

    #asistente-popup.visible #asistente-menu {
         /* transform: translateY(0); */ /* Eliminado para mantener el centrado vertical */
    }

    #asistente-menu .pro {
        width: 100%;
        margin: 0;
        text-align: left;
        padding: 10px 15px;
        background-color: #444;
        border: 1px solid #666;
    }

    #asistente-menu .pro:hover {
        background-color: #555;
        transform: scale(1.03);
    }
</style>

</head>
<body>
 


<div id="silenos" >
    <div id="opciones" >
        <h2 id="titulo-proyecto" style="display: none;" contenteditable="true" placeholder="Escribe el t√≠tulo del proyecto">Silenos Versi√≥n 1.1.10</h2>
        <div id="menu" >
         
        </div>
    </div>
 
    </div>

<button id="asistente-btn" title="Asistente IA">S</button>
<div id="asistente-popup">
    <div id="asistente-menu">
  <button class="tons"  onclick="cerrartodo(), abrir('vistageneral');">üëÅÔ∏è‚Äçüó®Ô∏è Vista General</button>
   <button class="tons"  onclick="cerrartodo(), gridear('personajes');">Datos</button>
             

            <button class="tons" onclick="abrir('guion-literario');">Gui√≥n</button>
            <button class="tons" onclick="cerrartodo(), abrir('capitulosh');">Libro</button>
            <button class="tons" onclick="cerrartodo(), abrir('escenah');">Storyboard</button>
            <button class="tons" onclick="cerrartodo(), abrir('animacionsvg');"style="display: none;">üé¨ Animaci√≥n</button>

   <button class="tons" onclick="cerrartodo(), abrir('animacionessvg');">üé¨ Animaci√≥n SVG</button>

            <button class="tons" onclick="cerrartodo(), abrir('imagenes');" style="display: none;" >Imagenes</button>
            <button class="tons" onclick="cerrartodo(), abrir('animaciones');"  style="display: none;"">Animaciones</button>

            <button class="tons" id="pelicula" onclick="cerrartodo(), abrir('galeria');" style="display: none;" >Pelicula</button>
            <button class="tons" onclick="cerrartodo(), abrir('momentos');"   >Videojuego</button>
                <button class="tons" onclick="cerrartodo(), abrir('juego');"  style="display: none;">Juego</button>
            <button class="tons" id="biblioteca-btn" style="display: none;" onclick="cerrartodo(), abrir('biblioteca');">üìö Biblioteca</button>
            <button class="pro" onclick="abrirModalConfig()">‚öôÔ∏è Ajustes </button>
     
        <button class="pro" onclick="guardarJSON()">üíæ Guardar</button>
        <input type="file" id="file-load" accept="application/json" onchange="cargarJSON(event)" style="display: none;">
        <button class="pro" onclick="document.getElementById('file-load').click()">üóÇÔ∏è Cargar</button>
       <button class="pro" onclick="abrirModalExportar()">üíΩ Exportar</button>
        <button class="pro" id="theme-toggle-button" onclick="toggleTheme()">üåô Tema</button>
    </div>
</div>

<div id="google-auth-container"></div>
<div id="galeria" style="display: none;">
  
    
  <!-- Botones para sidebars -->
    <button id="palette-toggle-btn" class="sidebar-toggle-btn left">üé®</button>
    <button id="inspector-toggle-btn" class="sidebar-toggle-btn right">üîç</button>
    <!-- ================== -->
    <!-- L√çNEA DE TIEMPO    -->
    <!-- ================== -->
    <div id="timeline-panel">
        <div id="timeline-controls">
            <button id="play-btn222" class="btn-base w-auto">‚ñ∂Ô∏è</button>
            <button id="pause-btn" class="btn-base w-auto">‚è∏Ô∏è</button>
            <button id="reset-btn" class="btn-base w-auto">‚è™</button>
            <button id="start-realtime-record-btn" class="btn-base btn-danger">üî¥</button>
            <button id="stop-realtime-record-btn" class="btn-base btn-danger" style="display: none;">‚¨õ</button>
            <button id="export-btn222" class="btn-base btn-secondary">üì∏</button>
            <span id="timeline-time-display">0.00s</span> </div>
        <div id="timeline-scrubber-area">
            <div id="timeline-ruler">
                </div>
            <div id="timeline-tracks">
                </div>
            <div id="timeline-scrubber">
                <div class="scrubber-handle"></div>
            </div>
        </div>
    </div>
    <!-- Contenedor Principal Flexbox -->
    <div id="main-container">

        <!-- ================== -->
        <!-- BARRA LATERAL IZQUIERDA -->
        <!-- ================== -->
        <aside id="palette-panel" class="sidebar left">
        

            <div class="sidebar-main-content">
                <div id="section-buttons" class="section-buttons-container">
                    <button class="section-btn active" data-section="palette-section">üé®</button>
                    <button class="section-btn" data-section="ground-section">üåø</button>
                    <button class="section-btn" data-section="terrain-brush-section">üñåÔ∏è</button>
                    <button class="section-btn" data-section="terrain-sculpt-section">üèîÔ∏è</button> <!-- NUEVO: Bot√≥n para la secci√≥n de modelado -->
                    <button class="section-btn" data-section="weather-section">‚òÄÔ∏è</button>
               
                    <button class="section-btn" data-section="general-controls-section">‚öôÔ∏è</button>
                </div>

                <div id="section-content" class="section-content-container">
                    <!-- Secci√≥n: Paleta de Objetos -->
                    <div id="palette-section" class="sidebar-section-content active">
                        <h2 class="section-title">Paleta de Objetos</h2>
                        <div id="object-palette-grid" class="palette-grid">
                            <!-- Los items de la paleta se generar√°n aqu√≠ con JS -->
                             <!-- NUEVO: Bot√≥n para crear personaje -->
                            <div id="create-character-btn-container" class="palette-item" title="Crear un nuevo personaje">
                                <div class="thumbnail-container">
                                    <span style="font-size: 2.5rem; line-height: 1; color: var(--color-text-secondary);">+</span>
                                </div>
                                <span>Crear Personaje</span>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n: Suelo -->
                    <div id="ground-section" class="sidebar-section-content">
                        <h2 class="section-title">Suelo</h2>
                        <div class="sidebar-content">
                            <p class="placeholder-text">Usa las secciones "Pincel de Terreno" y "Modelado de Terreno" para modificar el suelo.</p>
                        </div>
                    </div>

                    <!-- Secci√≥n de Pincel de Terreno -->
                    <div id="terrain-brush-section" class="sidebar-section-content">
                        <h2 class="section-title">Pincel de Terreno</h2>
                        <div class="sidebar-content">
                            <button id="terrain-brush-toggle-btn" class="btn-base btn-primary mb-4">
                                Activar/Desactivar Pincel üñåÔ∏è
                            </button>
                            
                            <div class="control-group">
                                <label class="control-label">Textura del Pincel</label>
                                <div class="btn-group">
                                    <button class="btn-base terrain-texture-btn active" data-texture="grass">C√©sped üåø</button>
                                    <button class="btn-base terrain-texture-btn" data-texture="rock">Roca ü™®</button>
                                    <button class="btn-base terrain-texture-btn" data-texture="sand">Arena üèñÔ∏è</button>
                                    <button class="btn-base terrain-texture-btn" data-texture="snow">Nieve ‚ùÑÔ∏è</button>
                                    <button class="btn-base terrain-texture-btn" data-texture="dirt">Tierra üå∞</button>
                                </div>
                            </div>

                            <div class="control-group">
                                <label for="brush-size-slider" class="control-label">Tama√±o del Pincel</label>
                                <input type="range" id="brush-size-slider" min="1" max="200" step="1" value="50">
                            </div>

                            <div class="control-group">
                                <label for="brush-strength-slider" class="control-label">Intensidad del Pincel</label>
                                <input type="range" id="brush-strength-slider" min="0.01" max="1.0" step="0.01" value="0.1">
                            </div>
                        </div>
                    </div>

                    <!-- NUEVO: Secci√≥n de Modelado de Terreno -->
                    <div id="terrain-sculpt-section" class="sidebar-section-content">
                        <h2 class="section-title">Modelado de Terreno</h2>
                        <div class="sidebar-content">
                            <button id="terrain-sculpt-toggle-btn" class="btn-base btn-primary mb-4">
                                Activar/Desactivar Esculpir ‚õ∞Ô∏è
                            </button>
                            
                            <div class="control-group">
                                <label class="control-label">Modo de Esculpir</label>
                                <div class="btn-group">
                                    <button class="btn-base sculpt-mode-btn active" data-mode="raise">Elevar ‚¨ÜÔ∏è</button>
                                    <button class="btn-base sculpt-mode-btn" data-mode="lower">Bajar ‚¨áÔ∏è</button>
                                    <button class="btn-base sculpt-mode-btn" data-mode="flatten">Aplanar „Ä∞Ô∏è</button>
                                    <button class="btn-base sculpt-mode-btn" data-mode="smooth">Suavizar üåä</button>
                                </div>
                            </div>

                            <div class="control-group">
                                <label for="sculpt-strength-slider" class="control-label">Fuerza de Esculpir</label>
                                <input type="range" id="sculpt-strength-slider" min="0.1" max="10" step="0.1" value="1.0">
                            </div>

                            <div class="control-group">
                                <label for="flatten-height-input" class="control-label">Altura de Aplanado</label>
                                <input type="number" id="flatten-height-input" class="text-input" value="0.0" step="0.1">
                                <p class="text-zinc-400 text-sm mt-1">Fija la altura al activar 'Aplanar' o escribe un valor.</p>
                            </div>
                        </div>
                    </div>
                    <!-- FIN NUEVA SECCI√ìN DE MODELADO -->

                    <!-- Secci√≥n: Clima y Hora -->
                    <div id="weather-section" class="sidebar-section-content">
                        <h2 class="section-title">Clima y Hora</h2>
                        <div class="sidebar-content">
                             <div class="control-group">
                                <label for="day-time-slider" class="control-label">Hora del d√≠a</label>
                                <input type="range" id="day-time-slider" min="0" max="1" step="0.01" value="0.5">
                            </div>
                            <div class="control-group">
                                <label for="precipitation-select" class="control-label">Precipitaci√≥n</label>
                                <select id="precipitation-select" class="select-input">
                                    <option value="none">Ninguno</option>
                                    <option value="rain">Lluvia üåßÔ∏è</option>
                                    <option value="snow">Nieve ‚ùÑÔ∏è</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="fog-density-slider" class="control-label">Densidad de Niebla</label>
                                <input type="range" id="fog-density-slider" min="0" max="0.01" step="0.0001" value="0.00025">
                            </div>
                            <div class="control-group">
                                <label for="cloud-density-slider" class="control-label">Opacidad de Nubes (Cielo)</label>
                                <input type="range" id="cloud-density-slider" min="0" max="100" step="1" value="0">
                            </div>
                            <div class="control-group">
                                <label for="volumetric-cloud-slider" class="control-label">Nubes Volum√©tricas</label>
                                <input type="range" id="volumetric-cloud-slider" min="0" max="100" step="1" value="0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n: Controles Generales -->
                    <div id="general-controls-section" class="sidebar-section-content">
                        <h2 class="section-title">Configuraci√≥n General</h2>
                         <div class="sidebar-content">
                            <button class="" onclick="hablar()">üì£ Hablar</button>
                            <div class="btn-group">
                                <button id="toggle-gravity-btn" class="btn-base tool-btn">üçé</button>
                                <button id="compass-btn" class="btn-base tool-btn">üß≠</button>
                                <button id="settings-btn" class="btn-base tool-btn">‚öôÔ∏è</button>
                            </div>
                            <hr class="my-4 border-zinc-600"> 
<div class="control-group">
    <label for="export-resolution-select" class="control-label">Resoluci√≥n de Exportaci√≥n</label>
    <select id="export-resolution-select" class="select-input">
        <option value="640x480">640x480 (SD) Horizontal</option>
                <option value="480x640">480x640 (SD) Vertical</option>
<option value="480x480">480x480 (SD) Cuadrado</option>

        <option value="1280x720" selected>1280x720 (HD) Horizontal</option>
                <option value="720x1280">720x1280 (HD) Vertical</option>
                <option value="720x720">720x720 (HD) Cuadrado</option>

        <option value="1920x1080">1920x1080 (Full HD) Horizontal</option>
                <option value="1080x1920">1080x1920 (Full HD) Vertical</option>
                <option value="1080x1080">1080x1880 (Full HD) Cuadrado</option>

        <option value="3840x2160">3840x2160 (4K UHD) Horizontal</option>
                <option value="2160x3840">2160x3840 (4K UHD) Vertical</option>
                <option value="2160x2160">2160x2160 (4K UHD) Cuadrado</option>

    </select>
</div>



                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ================== -->
        <!-- VISOR 3D           -->
        <!-- ================== -->
        <main id="scene-container"></main>

        <!-- ================== -->
        <!-- BARRA LATERAL DERECHA-->
        <!-- ================== -->
        <aside id="inspector-panel" class="sidebar right">
           
                <div class="botoon">
                       <button id="free-mode-btn" class="btn-base camera-mode-btn">üïäÔ∏è</button>
                                <button id="first-person-mode-btn" class="btn-base camera-mode-btn">üö∂</button>
                                <button id="programmed-mode-btn" class="btn-base camera-mode-btn">üé•</button>

  <label for="gltf-input" class="btn-base btn-tertiary">üì¶ GLB</label>
                            <input type="file" id="gltf-input" class="hidden-input" accept=".glb">
                            <label for="image-input" class="btn-base btn-tertiary">üñºÔ∏è IMG</label>
                            <input type="file" id="image-input" class="hidden-input" accept="image/png, image/jpeg, image/gif">

                      <button id="save-scene-btn" class="btn-base btn-primary">üíæ</button>
                            <label for="load-scene-input" class="btn-base btn-action">üìÇ</label>
                            <input type="file" id="load-scene-input" class="hidden-input" accept=".json"> </details>
                        
                        </div>
         
            
            <!-- Secci√≥n: Inspector -->
            <details class="sidebar-section" open>
                <summary>üîç Inspector</summary>
                <div class="sidebar-content" id="inspector-content">
                    <p class="placeholder-text">Selecciona un objeto para ver sus propiedades.</p>
                </div>
            </details>

            <!-- Secci√≥n: Objetos en Escena -->
            <details class="sidebar-section" open>
                <summary>üå≥ Objetos en Escena</summary>
                <div class="sidebar-content">
                    <ul id="object-list"></ul>
                </div> 
            
               
        </aside>

    </div>


    
    <!-- ================== -->
    <!-- MODAL PERSONALIZADO-->
    <!-- ================== -->
    <div id="custom-modal" class="modal-overlay" style="display: none;">
        <div class="scene-modal-content">
            <p id="modal-text"></p>
            <p id="modal-progress"></p>
            <input type="text" id="modal-input" class="modal-input" style="display: none;">
            <div class="modal-buttons">
                <button id="modal-cancel-btn" class="btn-base w-auto">Cancelar</button>
                <button id="modal-ok-btn" class="btn-base w-auto btn-primary">OK</button>
            </div>
        </div>
    </div>
    
    

</div>

<div id="animaciones" style="display: none;">
    <div class="contenedor-principal" style="display: flex; flex-direction: column; height: 100%; padding: 1rem; box-sizing: border-box;">

        <header class="text-center mb-4">
        
      
        </header>

        <main class="contenido-principal" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; flex-grow: 1;">

            <div class="columnas"  >
                
                <div id="script-section" class="seccion" style="display: flex; flex-direction: column; flex-grow: 1;">
            
                    <textarea id="script-input" class="area-texto" style="flex-grow: 1; resize: none;" placeholder="Ej: Un gorila entra por la izquierda. Un mago entra por la derecha. El gorila mira al mago y le habla. El mago salta."></textarea>
                    <button id="analyze-button" class="boton boton-analizar">
                        <svg id="analyze-icon" class="boton-icono" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        <svg id="loading-spinner" class="spinner-carga oculto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        Analizar Guion
                    </button>
                </div>

                <div id="elements-section" class="seccion2 oculto" style="display: flex; flex-direction: column;">
           
                    <div id="elements-list" class="lista-elementos" style="overflow-y: auto; padding: 0.5rem;"></div>
                </div>

                 <div id="error-message" class="mensaje-error oculto" role="alert">
                    <strong class="mensaje-error-titulo">¬°Error!</strong>
                    <span id="error-text"></span>
                </div>

            </div>

            <div class="columna"  >
         
                
                <div id="canvas-container" >
                    <div id="three-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
                    <canvas id="scene-canvas" class="oculto" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent;"></canvas>
                    <div id="canvas-placeholder" style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #6b7280;">
                        <span>La escena se renderizar√° aqu√≠</span>
                    </div>
                </div>

                <button id="render-button" class="boton boton-renderizar pro5" disabled>
                    Renderizar Escena
                </button>
            </div>
        </main>
    </div>
</div>


<div id="imagenes" style="display: none;">
    <div class="container">
        <!-- Interruptor 2D/3D -->
        <div class="image-mode-toggle">
            <button id="toggle-2d-btn" class="active">2D</button>
            <button id="toggle-3d-btn">3D</button>
        </div>

        <!-- Panel de control 2D (existente) -->
        <div class="control-panel" id="control-panel-2d">
          
            <div class="json-importer-container">
                <h3>Importar desde JSON</h3>
                <textarea id="json-input-area" placeholder="Pega aqu√≠ el JSON de uno o varios elementos..." class="area-texto"></textarea>
                <div class="json-buttons-container">
                    <button id="btn-process-json" class="control-button">Procesar JSON Pegado</button>
                    <label for="json-file-input" class="control-button">Cargar Archivo JSON</label>
                    <input type="file" id="json-file-input" accept=".json,application/json" style="display: none;">
                </div>
            </div>
 
            
           
            
        </div>
        



        <!-- Nuevo Panel de control 3D -->
        <div class="control-panel" id="control-panel-3d" style="display: none;">
<div id="generador-3d-panel" class="generador-panel">
            <h3>Generador 3D</h3>
            <div class="prompt-section">
                <textarea id="user-prompt-input-3d" placeholder="Describe la escena 3D que quieres crear... por ejemplo: 'un cohete rojo y blanco en el centro, y un peque√±o planeta azul a su derecha'"></textarea>
                <button id="btn-generate-3d" class="btn-icon" title="Generar Escena 3D">
                   Generar 3D
                     
                </button>
            </div>
            <div id="render-container-3d" style="width: 100%; height: 400px; position: relative; border-radius: 8px; overflow: hidden;">
                <canvas id="render-canvas-3d"></canvas>
                <div id="status-message-3d" class="status-message">Esperando prompt...</div>
             <button id="btn-save-generation-3d" class="btn-primary">Guardar Generaci√≥n</button></div>
            
            <div class="actions-section">
               
            </div>
        </div>


         
   
   
   
        </div>

        <div id="generaciones-container" style="display: none;">
            <div id="generaciones-grid">
                </div>
        </div>
    </div>
</div>


<div id="momentos">
    <button class="pro5" id="agregar-momento-btn">‚ûï</button>
    <div id="momentos-controles-flotantes">
        
        <button class="pro" id="preview-connections-btn" title="Muestra u oculta las l√≠neas de conexi√≥n entre momentos.">Previsualizar Conexiones</button>

        <div class="control-group">
            <button class="pro" id="zoom-out-btn" title="Alejar la vista">-</button>
            <span id="zoom-level-indicator">100%</span>
            <button class="pro" id="zoom-in-btn" title="Acercar la vista">+</button>
        </div>

        
        <div id="momentos-controles-ia">
            <button class="pro" id="generar-aventura-ia-btn" title="Usa la IA para generar una aventura interactiva completa a partir del guion seleccionado.">Generar Aventura con IA ‚ú®</button>
            <select id="guion-select" class="pro" title="Selecciona un guion para usar como base para la IA"></select>

            <input type="number" id="ia-call-budget-input" class="pro ia-input-numero" min="5" max="100" value="15" title="Presupuesto de Llamadas a la IA. Define el n√∫mero m√°ximo de peticiones para crear y expandir ramas en la historia. Un n√∫mero m√°s alto crea una aventura m√°s grande y compleja.">
            </div>
    </div>

    <div id="momentos-lienzo-wrapper">
        <div id="momentos-lienzo">
            <svg id="connections-svg"></svg>
        </div>
    </div>
    
        <!-- NUEVO: Panel de Edici√≥n de Momentos -->
    <div id="panel-edicion-momento">
        <div class="panel-edicion-header">
            <h3>Editar Momento</h3>
            <button id="panel-edicion-cerrar-btn">&times;</button>
        </div>
        <div class="panel-edicion-contenido">
            <input type="text" id="panel-editor-titulo" placeholder="T√≠tulo del Momento">
            <textarea id="panel-editor-descripcion" placeholder="Descripci√≥n..."></textarea>
            <div id="panel-editor-drop-zone" class="drop-zone-estilo">
                Arrastra una imagen aqu√≠ o haz clic
                <img id="panel-editor-imagen-preview" alt="Vista previa de la imagen">
                <input type="file" id="panel-editor-file-input" accept="image/*" style="display: none;">
            </div>
            
            <!-- ===================================== -->
            <!-- ELEMENTOS RESTAURADOS - ¬°ESTO ES LO QUE FALTABA! -->
            <!-- ===================================== -->
            <div id="panel-acciones-container"></div>
            <button id="panel-boton-agregar-accion" class="modal-button ">+ Acci√≥n</button>
            
        </div>
    </div>


</div>

<div id="animacionessvg">
    <div id="toast"></div>

    <div id="keyframe-menu">
        <div>
            <div>
                <label for="easing-select">Movimiento:</label>
                <select id="easing-select">
                    <option value="linear">Lineal</option>
                    <option value="steps">Pasos Suaves</option>
                    <option value="ease-in-out">Suave</option>
                </select>
            </div>
            <button id="delete-keyframe-btn">Eliminar Keyframe</button>
        </div>
    </div>

<header>
    <div>
        <button id="import-svg-btn">Importar SVG</button>
        <button id="import-img-btn">Importar Imagen</button>
        <button id="import-dato-img-btn">Importar Imagen de Dato</button>
        <input type="file" id="import-input" class="hidden">
        <button id="add-rect-btn">A√±adir Rect√°ngulo</button>
        <button id="add-circle-btn">A√±adir C√≠rculo</button>
        <div class="color-picker-container">
            <label for="color-picker">Color:</label>
            <input type="color" id="color-picker" value="#3b82f6">
        </div>
        <div id="selection-actions">
            <button id="flip-h-btn" title="Voltear Horizontal">‚Üî</button>
            <button id="flip-v-btn" title="Voltear Vertical">‚Üï</button>
            <button id="delete-btn">Eliminar</button>
        </div>
    </div>
</header>

    <main>
        <aside id="layer-panel">
        
            <div id="layer-list"></div>
        </aside>

        <div id="canvas-container">
            <svg id="svg-canvas" width="100%" height="100%">
                <g id="shapes-container"></g>
                <g id="transform-controls">
                    <rect id="transform-box-outline"></rect>
                    <g id="transform-handles">
                        <rect class="handle resize-handle" data-handle="top-left" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="top-middle" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="top-right" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="middle-left" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="middle-right" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="bottom-left" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="bottom-middle" width="10" height="10"></rect>
                        <rect class="handle resize-handle" data-handle="bottom-right" width="10" height="10"></rect>
                        <line id="rotation-line"></line>
                        <circle id="rotation-handle" class="handle" r="7"></circle>
                    </g>
                </g>
            </svg>
        </div>
    </main>

    <footer>
        <div>
            <div class="controls-group">
                <button id="play-btn">Play</button>
                <button id="set-keyframe-btn">Fijar Keyframe</button>
            </div>
            <div class="timeline-controls-group">
                <span id="time-label">0.0s</span>
                <input type="range" id="timeline-slider" min="0" max="5000" value="0">
            </div>
            <div class="duration-controls-group">
                <label for="duration-input">Duraci√≥n (s):</label>
                <input type="number" id="duration-input" value="5" min="1">
            </div>
            <button id="export-btn3">Exportar SVG</button>
        </div>
    </footer>
</div>




<div id="juego" style="display: none; width: 100%; height: 100%;">
    <div id="editor-container">
        <header id="main-header">
            <h1>Editor de Mundos</h1>
            <div id="main-controls">
                <div id="zoom-controls">
                    <button id="zoom-out-button" class="zoom-btn">-</button>
                    <button id="zoom-in-button" class="zoom-btn">+</button>
                </div>
                <button id="preview-button">üöÄ Previsualizar</button>
                <button id="save-button">üíæ Guardar en Navegador</button>
            </div>
        </header>
        <main id="main-content">
            <aside id="side-panel">
                <div id="texture-palette" class="palette">
                    <h2>Texturas de Terreno</h2>
                </div>
                <div id="entity-palette" class="palette">
                    <h2>Entidades</h2>
                </div>
                 <div id="info-box" class="palette">
                    <h2>Informaci√≥n</h2>
                    <p>Clic en una textura para pintar el terreno.</p>
                    <p>Clic en una entidad y luego en un chunk para editarlo.</p>
                </div>
            </aside>
            <div id="map-grid-container">
                <div id="map-grid"></div>
            </div>
        </main>
    </div>
    <div id="preview-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="modal-close-button">&times;</span>
            <h3>Previsualizaci√≥n del Mundo 3D</h3>
            <div id="game-container"></div>
        </div>
    </div>
</div>




<!-- INICIO DE LA SECCI√ìN DE VISTA GENERAL -->
 <div id="vistageneral" >




     <button  style="display: none;"  class="pro6" id="selector-general-btn-local">‚ò∞</button>
    <!-- Encabezado y bot√≥n de acci√≥n -->
    <div>
        
    
        <button id="analizar-datos-btn" class="pro5" >
            Analizar Datos
        </button>
    </div>

<div id="biblioteca" style="display: none;" >
    <div id="biblioteca-grid"></div>
</div>

    <div id="informe-container">
 
      
    </div>

    
<div id="vistageneral-secciones" >
    <button class="pro6" onclick=" document.getElementById('informe-container').style.display = 'flex', document.getElementById('biblioteca').style.display = 'none'; " >üìú</button>
    <button class="pro7" onclick=" document.getElementById('informe-container').style.display = 'none', abrir('biblioteca'), document.getElementById('vistageneral').style.display = 'flex';  " >üñºÔ∏è</button>

</div>
</div>
 

<div id="guion-literario">
    <div id="guion-toolbar">
        <!-- El bot√≥n para abrir el selector de guiones se mueve aqu√≠ -->
        <button class="pro6" id="selector-guion-btn-local">‚ò∞</button>
        <button class="pro5" id="sumar-capitulo-guion" onclick="agregarCapituloYMostrar()">‚ûï</button>
    </div>
    <div id="guion-layout">
        <!-- El √≠ndice lateral se elimina de la vista, pero el div se puede mantener para compatibilidad -->
        <div id="indice-capitulos-guion" style="display: none;"></div>
        
        <!-- Contenedor para la lista emergente de guiones -->
        <div id="lista-guiones-popup-local"></div>

        <!-- El contenido del cap√≠tulo ahora ocupa m√°s espacio -->
        <div id="contenido-capitulo-activo">
        </div>
    </div>
</div>

<div id="ia" >
    <div id="creasion" >
        <button class="pro" onclick="cerrartodo(), abrir('capitulosh'), actualizarParametrosIA(), crearEscenasAutomaticamente(nombredelahistoria, cantidaddeescenas, cantidadframes);">Insertar Cap√≠tulos vac√≠os en la Historia</button>
        <input type="text" id="nombrehistoria" placeholder="Nombre de las Escenas" value="Nombre de la Historia">
        <input type="number" id="cantidadescenas" placeholder= "Cantidad de Escenas" value="2">
        <input type="number" id="cantidadeframes" placeholder= "Cantidad de Frames" value="3">
    </div>

    <textarea id="gemini1"  placeholder="Escribe tu Historia..."></textarea>

    <div id="chateo" >
        <div id="ia-options">
            <input type="checkbox" id="incluir-datos-ia" checked>
            <label for="incluir-datos-ia">Usar Datos ya Guardados en la generaci√≥n de la Historia</label>
        </div>
        <div id="ia-buttons">
            <button id="enviargemini"  class="pro" onclick="actualizarParametrosIA(), enviarTextoConInstrucciones()">Generar Historia</button>
            <button id="enviargemini-desarrollar"  class="pro" onclick="actualizarParametrosIA(), desarrollarFramesDesdeGeminimente(nombredelahistoria); cerrartodo(); abrir('capitulosh');">Insertar Frames en la Historia</button>
        </div>
    </div>

    <div id="geminimente"></div>
</div>


<div id="editor">
      <p></p>
      <p></p>
      <p></p>
<div id="chat"></div>
<button onclick="herramientacopiar()"> üì• </button><div id="herramienta" ></div>
<textarea id="user-input" placeholder="Escribe tu mensaje..."></textarea>
<button id="enviar" onclick="enviartexto()">Enviar</button>
<div id="modos" ></div></div>

<div id="escenah">
    <button id="crear-escena-btn" class="pro6" onclick="abrirSelectorDeEscena(event)">+ üé¨</button>
    <div class="escena-toolbar">
         <button id="generargraficos" >Generar gr√°ficos de la escena con IA</button>
        <select id="escenas-dropdown"></select>
        <input type="text" id="escena-nombre-input" placeholder="Nombre de la Escena...">
        <button id="agregar-toma-btn" class="escena2 pro5 "  >‚ûï</button>
    </div>
    
    <div id="tomas-timeline">
        </div>
</div>


<div id="capitulosh">
    <button id="selector-libro-btn" class="pro6" onclick="abrirSelectorDeLibro(event)">‚ò∞</button>
    
    <div id="libro-activo-titulo"> </div>
    
    <button class="pro5" id="sumarpersonaje" onclick="nuevaEscena()">‚ûï</button>

    <div id="capitulos">
        <div id="lista-capitulos"></div>
    </div>
</div>

<div id="selector-libro-popup" class="lista-guiones-popup-local" style="display: none;">
    </div>
<div id="modal-seleccionar-libro-para-frames" class="modal-content" style="display: none;">
    <button class="modal-close-button" onclick="cerrarModalSeleccionLibro()">&times;</button>
    <h3>Generar Frames con IA</h3>

    <div class="modal-seccion">
        <label for="guion-origen-select">1. Elige el Guion a utilizar como base:</label>
        <select id="guion-origen-select" class="modal-select"></select>
    </div>

    <div class="modal-seccion">
        <label>2. Elige el Libro donde se guardar√°n los cap√≠tulos:</label>
        <div id="lista-libros-para-frames" class="lista-libros-popup-estilo">
            </div>
    </div>

    <button id="confirmar-generacion-frames-btn" class="modal-button principal-action" onclick="confirmarSeleccionYProcesar()">
        ‚ú® Generar en Libro Seleccionado
    </button>
</div>
<div id="personajes">
    <button class="pro16" onclick="modalExportarDatos()" >E</button>
    <div class="herramientas" ></div>
    <div id="datos-botones-superiores">
        <button class="pro5" id="sumarpersonaje" onclick="agregarPersonaje()">‚ûï</button>


    </div>
    <div id="listapersonajes"></div></div>
</div>

<div id="escena-vista">
    <textarea id="escena-texto" placeholder="Texto de la escena"></textarea>
    <div id="drop-zone"   >
        <img id="imagen-preview" alt="Vista previa de la imagen">
    <input type="file" id="file-input" accept="image/*, video/mp4, video/webm, image/gif"  style="display: none;" ></div>
<div id="botonesss"   >
    <button class="botoness" onclick="agregarBoton('transicion')">‚ûï Transici√≥n</button>
    <button class="botoness" onclick="agregarBoton('accion')">‚ûï Acci√≥n</button></div>
<div class="lista" > <div id="botones-lista"></div></div>
</div>
<video id="hiddenVideoPlayer" style="display:none;"></video>
<canvas id="hiddenCanvas" style="display:none;"></canvas>

<div id="modal-overlay"></div>




<div id ="animacionsvg" class="nom" >

    <div class="animation-container">
        <div class="main-content">
            <div class="canvas-wrapper">
                <canvas id="animation-canvas"></canvas>
            </div>
            <div class="controls-panel">
                <h3>Control de Animaci√≥n</h3>
                <textarea id="animation-prompt" placeholder="Describe la escena que quieres animar. Por ejemplo: 'Un samurai aparece desde la izquierda y desenfunda su katana. La c√°mara hace un zoom lento a su rostro.'"></textarea>
                <div class="button-group">
                    <button id="generate-animation-btn">‚ú® Generar Animaci√≥n</button>
                    <button id="play-pause-btn" disabled>‚ñ∂Ô∏è Reproducir</button>
                </div>
            </div>
        </div>
    </div>



</div>


<div id="modal-ia-herramientas" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalIAHerramientas()">&times;</button>
    <h3>Herramientas de Creaci√≥n con IA</h3>

    <div class="ia-modal-section">
        <label for="gemini1-modal">Escribe la idea para tu historia:</label>
        <textarea id="gemini1-modal" placeholder="Ej: Un detective en un Madrid futurista investiga la desaparici√≥n de un androide con recuerdos humanos..."></textarea>
    </div>

    <div class="ia-modal-section">
        <h4>Opciones de Generaci√≥n</h4>
        <div class="ia-modal-controls">
            <div class="ia-modal-control-group">
                <label for="cantidadescenas-modal">Cap√≠tulos a generar:</label>
                <input type="number" id="cantidadescenas-modal" value="3" min="1">
            </div>
            <div class="ia-modal-control-group">
                <label for="cantidadeframes-modal">Frames por cap√≠tulo:</label>
                <input type="number" id="cantidadeframes-modal" value="4" min="1">
            </div>
        </div>
        
        <div class="ia-modal-checkbox" style="margin-top: 15px; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="incluir-datos-ia-modal" checked>
            <label for="incluir-datos-ia-modal">Usar Datos (Personajes, Lugares, etc.) para dar contexto a la IA</label>
        </div>
        </div>
    
    <div class="ia-modal-section">
        <h4>Filtrar Datos por Arco Narrativo</h4>
        <p style="font-size: 0.8em; color: #bbb; margin-top: -5px;">Selecciona los arcos narrativos cuyos datos quieres que la IA utilice como contexto para generar la historia.</p>
        <div id="ia-arcos-filter-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-height: 150px; overflow-y: auto; padding: 10px; background-color: rgba(0,0,0,0.2); border-radius: 5px;">
        </div>
    </div>

    <div class="ia-modal-actions">
        <button class="modal-button principal-action" onclick="lanzarGeneracionHistoria()">‚ú® Generar Historia Completa</button>
    </div>
</div>



<div id="lugares" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalConfig()">&times;</button>
        <input type="text" id="asistente-titulo-input" placeholder="T√≠tulo del proyecto">

    <p>Para utilizar la inteligencia artificial de Silenos necesita:</p>
    <p>Una API KEY de GOOGLE, puede obtenerla aqu√≠:</p>
    <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer"  style="padding: 10px 20px; background-color: rgb(0, 0, 0); color: white; text-decoration: none; border-radius: 5px;">
     AI Studio de Google.com
    </a><p></p>
    <input type="text" id="apiInput" placeholder="Ingresa tu API Key">
    <button onclick="updateApiKey()">Actualizar</button>
    <p>API Key actual: <span id="apiKeyDisplay">[No definida]</span></p>
</div>

<div id="modal-importar-json" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalImportar()">&times;</button>
    <h3>Importar Datos desde JSON</h3>
    <p>Pega el contenido de un √∫nico objeto JSON (un dato, cap√≠tulo, etc.) en el siguiente campo.</p>
    <textarea id="json-import-area" placeholder='Ejemplo para un "Dato":\n{\n  "nombre": "Espada Legendaria",\n  "descripcion": "Forjada por los dioses.",\n  "etiqueta": "objeto",\n  "imagen": ""\n}'></textarea>
    <button class="modal-button" onclick="importarDatosDesdeJSON()">A√±adir Datos</button>
</div>

<div id="modal-ia-datos" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalAIDatos()">&times;</button>
    <h3>A√±adir Datos con Inteligencia Artificial</h3>
    <p>Pega aqu√≠ el nombre de una obra (ej: "Star Wars"), una lista de ideas, o un JSON para que la IA los procese y a√±ada como datos estructurados.</p>
    <textarea id="ia-datos-area" placeholder='Ejemplo 1: El Se√±or de los Anillos

Ejemplo 2: Un caballero valiente llamado Arthur, su espada m√°gica Excalibur, el reino de Camelot.

Ejemplo 3: [{"nombre": "Dato 1", "descripcion": "..."}]'></textarea>
    <button class="modal-button" onclick="procesarEntradaConIA()">‚ú® Analizar y Agregar Datos</button>
</div>

<!-- ELIMINADO: Modal de editar momento -->

<div id="modal-exportar" class="modal-content">
    <button class="modal-close-button" onclick="cerrarModalExportar()">&times;</button>

    <div class="export-option">
        <h4>Exportar Libro a HTML</h4>
        <p>Selecciona un libro de la lista para exportar todos sus cap√≠tulos y frames a un √∫nico archivo HTML.</p>
        <div class="export-controls">
            <select id="libro-export-select" class="modal-select"></select>
            <button class="modal-button" onclick="exportarLibroSeleccionado()">Exportar Libro HTML</button>
        </div>
    </div>
    <hr> <div class="export-option">
        <h4>Exportar Guion</h4>
        <p>Exporta los cap√≠tulos y sus frames a un archivo HTML simple.</p>
        <button class="modal-button" onclick="generarHTML()">Exportar Guion HTML</button>
    </div>
   <div class="export-option">
        <h4>Exportar Storyboard de Tomas</h4>
        <p>Exporta las escenas de storyboard (im√°genes y texto) a un archivo HTML.</p>
         <div class="export-controls">
             <select id="tomas-export-select" class="modal-select"></select>
             <button class="modal-button" onclick="generarHTMLTomas()">Exportar Tomas HTML</button>
        </div>
    </div>
    <div class="export-option">
        <h4>Exportar Videojuego</h4>
        <p>Exporta los momentos como una experiencia interactiva.</p>
        <select id="momento-inicial-id" class="modal-select"></select>
        <button id="exportar-juego-3d-btn">Exportar Juego 3D</button>

        <button class="modal-button" onclick="iniciarExportacionJuego()">Exportar Videojuego HTML</button>
    </div>
</div>


 <button id="asistente-btn" title="Asistente IA"  style="display: none;" >S</button>
</div>
 
<div id="principio">
    <video autoplay muted loop id="video-fondo">
        <source src="video.mp4" type="video/mp4">
        Tu navegador no soporta videos HTML5.
    </video>
    <div id="titulo-esfera-container"> 
        <div id="titulo1">
            <div>
                <span>SILEN</span><span class="os-red">OS</span>
            </div>
            <div class="version-text">
                versi√≥n 1.1.10
            </div>
        </div>
        <div id="esfera">
           <button class="pro3" onclick="iniciarAnimacionSalida(), cerrartodo(), abrir('personajes'); ">Nuevo</button>
            <button class="pro3" onclick="document.getElementById('file-load').click(); iniciarAnimacionSalida();">Cargar</button>
        </div>
    </div>
</div>


<div id="progress-bar-container" class="status-indicator">
    <span id="progress-bar-label">Procesando...</span>
    <div class="progress-bar-background">
        <div id="progress-bar-fill"></div>
    </div>
    <span id="progress-bar-percentage">0%</span>
</div>

<div id="esfera2" ></div>


<div id="modal-momentos-ia" class="modal-content" style="display: none; width: auto; max-width: 600px;">
    <button class="modal-close-button" onclick="cerrarModalMomentosIA()">&times;</button>
    
    <h3>Generar Aventura Interactiva con IA</h3>
    <p style="font-size: 0.9em; color: #666; text-align: center; margin-bottom: 15px;">
        Define los par√°metros de tu historia. La IA construir√° una red de momentos basada en tus especificaciones y el guion seleccionado.
    </p>

    <div id="modal-ia-content-placeholder" style="width: 100%; display: flex; flex-direction: column; gap: 20px;">
        <div class="ia-control-row">
            <label for="guion-select-modal">Guion de Referencia:</label>
            <select id="guion-select-modal" class="pro"></select>
        </div>

        <div class="ia-control-row">
            <label for="ia-nodos-input">Momentos Totales (Nodos):</label>
            <input type="number" id="ia-nodos-input" class="pro ia-input-numero" min="5" max="100" value="15">
        </div>

        <div class="ia-control-row">
            <label for="ia-finales-input">Finales Deseados:</label>
            <input type="number" id="ia-finales-input" class="pro ia-input-numero" min="1" max="10" value="2">
        </div>
        
        <div class="ia-control-row">
            <label for="ia-densidad-slider">Densidad de Ramificaci√≥n:</label>
            <input type="range" id="ia-densidad-slider" min="1" max="5" value="2" step="1">
            <span id="ia-densidad-label">Baja</span>
        </div>

        <div class="ia-info-box">
            <div id="ia-min-nodos-display">Nodos m√≠nimos recomendados: 7</div>
            <div id="ia-api-calls-display">Peticiones a la API estimadas: ~16</div>
        </div>

        <button id="generar-aventura-ia-btn-modal" class="pro modal-button">‚ú® Generar Aventura</button>
    </div>
</div>

<style>
    .ia-control-row { display: flex; justify-content: space-between; align-items: center; gap: 15px; }
    .ia-control-row label { font-weight: 500; flex-shrink: 0; }
    .ia-control-row input[type="number"], .ia-control-row select { width: 80px; text-align: center; }
    .ia-control-row input[type="range"] { flex-grow: 1; }
    .ia-info-box { 
        text-align: center; font-size: 0.85em; background-color: rgba(0,0,0,0.05); 
        padding: 8px; border-radius: 4px; color: #555; margin-top: 10px;
    }
    .dark-theme .ia-info-box { background-color: rgba(255,255,255,0.08); color: #ccc; }
    #generar-aventura-ia-btn-modal:disabled { background-color: #999; cursor: not-allowed; }
</style>

   <!-- ================== -->
    <!-- MODAL PERSONALIZADO-->
    <!-- ================== -->
    <div id="custom-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p id="modal-text"></p>
            <p id="modal-progress"></p>
            <input type="text" id="modal-input" class="modal-input" style="display: none;">
            <div class="modal-buttons">
                <button id="modal-cancel-btn" class="btn-base w-auto">Cancelar</button>
                <button id="modal-ok-btn" class="btn-base w-auto btn-primary">OK</button>
            </div>
        </div>
    </div>
    <div id="modal-imagenes" class="modal-content" style="display: none;">
    <div class=" ">
        <button class="modal-close-btn-fullscreen" onclick="cerrarModalImagenes()">&times;</button>
        <div class="container">
            <div class="image-mode-toggle" style="display: none;">
                <button id="toggle-2d-btn" class="active">2D</button>
                <button id="toggle-3d-btn">3D</button>
            </div>
            <div class="control-panel" id="control-panel-2d">
                 <textarea class="area-texto" id="user-prompt-input" placeholder="Ej: 'un hechicero de hielo en un bosque nevado', 'un caballero con armadura dorada frente a un castillo'"></textarea>
                <button id="btn-generate">Dise√±ar y Renderizar Escena</button>
                <button id="btn-save-generation" style="display: none;">Guardar en Generaciones</button>
                <div class="json-importer-container">
                   
                    <textarea id="json-input-area" placeholder="Pega aqu√≠ el JSON de uno o varios elementos..." class="area-texto"></textarea>
                    <div class="json-buttons-container">
                        <button id="btn-process-json" class="control-button">Procesar JSON Pegado</button>
                        <label for="json-file-input" class="control-button">Cargar Archivo JSON</label>
                        <input type="file" id="json-file-input" accept=".json,application/json" style="display: none;">
                    </div>
                </div>

        

                <div id="render-container"  >
                    <canvas id="render-canvas" width="512" height="512"></canvas> <p id="status-message"></p> 
                </div>
            </div>
            <div class="control-panel" id="control-panel-3d" style="display: none;">
                 </div>
            <div id="generaciones-container" style="display: none;">
                <div id="generaciones-grid"></div>
            </div>
        </div>
    </div>
</div>
    <!-- ================== -->
    <!-- MODAL CREADOR DE PERSONAJES -->
    <!-- ================== -->
    <div id="character-creator-modal" class="modal-overlay" style="display: none;">
        <div class="scene-modal-content" style="max-width: 600px;">
            <h2 class="section-title">Creador de Personajes</h2>
            <div id="character-creator-content">
                <div id="character-preview"></div>
                <div id="character-options">
                     <div class="control-group">
                        <label for="char-name" class="control-label">Nombre del Personaje</label>
                        <input type="text" id="char-name" class="modal-input" value="Mi Personaje" style="display: block;">
                    </div>
                    <div class="control-group">
                        <label for="char-head-color" class="control-label">Color de Cabeza</label>
                        <input type="color" id="char-head-color" value="#ffc0cb">
                    </div>
                     <div class="control-group">
                        <label for="char-body-color" class="control-label">Color de Cuerpo</label>
                        <input type="color" id="char-body-color" value="#87ceeb">
                    </div>
                     <div class="control-group">
                        <label for="char-height" class="control-label">Altura</label>
                        <input type="range" id="char-height" min="0.5" max="2" step="0.1" value="1">
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="cancel-char-creation-btn" class="btn-base w-auto">Cancelar</button>
                <button id="save-char-btn" class="btn-base w-auto btn-primary">Guardar en Paleta</button>
            </div>
        </div>
    </div>

<div id="visor-overlay">
    <img id="visor-imagen" src="" alt="Imagen ampliada">
    <div id="visor-controles">
        <a id="visor-boton-descargar" href="#" download>Descargar</a>
        <button id="visor-boton-reemplazar">Reemplazar</button>
    </div>
    <input type="file" id="reemplazar-input" accept="image/*" style="display: none;">
</div>

<div id="progress-bar-container" class="status-indicator">
    <span id="progress-bar-label">Procesando...</span>
    <div class="progress-bar-background">
        <div id="progress-bar-fill"></div>
    </div>
    <span id="progress-bar-percentage">0%</span>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<!-- SCRIPTS MOVED HERE, INSIDE THE BODY TAG -->
<script type="module">
  import { generarToma } from './escenas/geminivideo.js';
  window.generarToma = generarToma; 
</script>
<script src="compositor-escenas-3d.js"></script>
<!-- <script src="escenas/geminivideo.js"></script> <!-- This was a duplicate load and has been removed -->

<script src="escenas/generacion2d.js"></script>
<script src="momentos.js"></script>
<script src="editor-momento.js"></script> 
<script src="guion.js"></script>
<script src="galeria.js"></script> 
<script src="escenas.js"></script>
<script src="datos.js"></script>
<script src="io.js"></script>
<script src="gemini.js"></script>
<script src="geminialfa.js"></script>
<script src="geminivisual.js"></script>
<script src="generador.js"></script>
<script src="generador3d.js"></script> <!-- Nuevo script para 3D -->

<script src="compositor-escenas.js"></script> 

<script src="gestionEscenas.js"></script>  
<script src="exportar.js"></script>
<script src="exportarjuego.js"></script>
<script src="exportartomas.js"></script>
<script src="editor-personajes-head.js"></script>
<script src="editor-personajes-body.js"></script>
<script src="editor-personajes-main.js"></script>
<script type="module" src="animacion2d.js"></script>
<script type="module" src="juego_main.js"></script>



<button id="open-imagenes-modal-btn" class="" title="Abrir Galer√≠a de Im√°genes" onclick="abrirModalImagenes()" style="display: none;">üñºÔ∏è</button>
<button id="contextual-action-btn" title="Acci√≥n contextual" style="display: none;">‚ú®</button>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="geminiasistente.js"></script>
<script src="animaciones.js"></script>

<script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/" : "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
            "tween": "https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@21.0.0/dist/tween.esm.js"
        }
    }
</script>

<script type="module" src="editor-escenas-main.js"></script>
<script type="module" src="escenas/editor-escenas-ui.js"></script>
<script type="module" src="escenas/editor-escenas-objects.js"></script>
<script type="module" src="escenas/editor-escenas-weather.js"></script>
<script type="module" src="escenas/editor-escenas-modelos.js"></script>
<script type="module" src="escenas/editor-escenas-exportar.js"></script>
<script type="module" src="escenas/editor-escenas-terreno.js"></script>
<script type="module" src="escenas/editor-escenas-animacion.js"></script>
<script type="module" src="escenas/character-creator.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>

<script src="toma.js"></script>
<script src="animacionsvg.js"></script>
<script src="exportarjuego3d.js"></script>

<script src="animacionessvg.js"></script>


<script src="main.js" defer></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const asistenteBtn = document.getElementById('asistente-btn');
        const asistentePopup = document.getElementById('asistente-popup');
        const asistenteTituloInput = document.getElementById('asistente-titulo-input');
        const tituloProyecto = document.getElementById('titulo-proyecto');

        const togglePopup = (event) => {
            event.stopPropagation();
            const isVisible = asistentePopup.classList.toggle('visible');
            if (isVisible) {
                asistenteTituloInput.value = tituloProyecto.textContent.trim();
                asistenteTituloInput.focus();
            }
        };

        const closePopup = () => {
            asistentePopup.classList.remove('visible');
        };

        asistenteBtn.addEventListener('click', togglePopup);

        asistenteTituloInput.addEventListener('input', () => {
            tituloProyecto.textContent = asistenteTituloInput.value;
        });

        document.addEventListener('click', (event) => {
            if (!asistentePopup.contains(event.target) && !asistenteBtn.contains(event.target)) {
                if (asistentePopup.classList.contains('visible')) {
                    closePopup();
                }
            }
        });

        asistentePopup.addEventListener('click', (event) => {
            event.stopPropagation();
        });

        // L√≥gica del interruptor 2D/3D en la secci√≥n de im√°genes
        const toggle2dBtn = document.getElementById('toggle-2d-btn');
        const toggle3dBtn = document.getElementById('toggle-3d-btn');
        const controlPanel2d = document.getElementById('control-panel-2d');
        const controlPanel3d = document.getElementById('control-panel-3d');

        function toggleImageMode(mode) {
            if (mode === '2d') {
                toggle2dBtn.classList.add('active');
                toggle3dBtn.classList.remove('active');
                controlPanel2d.style.display = 'block'; // O 'flex' si es un flex container
                controlPanel3d.style.display = 'none';
            } else if (mode === '3d') {
                toggle3dBtn.classList.add('active');
                toggle2dBtn.classList.remove('active');
                controlPanel3d.style.display = 'block'; // O 'flex'
                controlPanel2d.style.display = 'none';
            }
        }

        toggle2dBtn.addEventListener('click', () => toggleImageMode('2d'));
        toggle3dBtn.addEventListener('click', () => toggleImageMode('3d'));

        // Establecer el modo 2D como predeterminado al cargar la p√°gina
        toggleImageMode('2d');
    });
</script>


<script>
    /**
     * Funci√≥n de animaci√≥n de salida MEJORADA.
     * Activa la animaci√≥n 3D y luego realiza la transici√≥n de la p√°gina.
     */
function iniciarAnimacionSalida() {
    const principio = document.getElementById('principio');
    const esfera = document.getElementById('esfera');
    const silenos = document.getElementById('silenos');
    const asistenteBtn = document.getElementById('asistente-btn');
    const titulo1 = document.getElementById('titulo1');

    // Ocultar los botones dentro de la esfera para que no se vean durante la expansi√≥n
    const botonesEnEsfera = esfera.getElementsByTagName('button');
    for (let i = 0; i < botonesEnEsfera.length; i++) {
        botonesEnEsfera[i].style.opacity = '0';
    }

    // Ocultar el t√≠tulo superior
    if (titulo1) {
        titulo1.style.opacity = '0';
    }

    // A√±adir la clase que inicia la expansi√≥n de la esfera
    esfera.classList.add('expandir');

    // La animaci√≥n de expansi√≥n en styles2.css dura 1 segundo.
    // Los siguientes pasos est√°n sincronizados con esa animaci√≥n.

    // 1. Mostrar el bot√≥n del asistente durante la transici√≥n
    setTimeout(() => {
        if (asistenteBtn) {
            asistenteBtn.classList.add('visible');
        }
    }, 1000);

    // 2. Empezar a desvanecer toda la pantalla de bienvenida
    setTimeout(() => {
        principio.style.opacity = '0';
    }, 1500);

    // 3. Ocultar la pantalla de bienvenida y mostrar la aplicaci√≥n principal
    setTimeout(() => {
        principio.style.display = 'none';
        silenos.style.display = 'flex';
        silenos.getBoundingClientRect(); // Forzar reflow para asegurar la animaci√≥n
        silenos.style.opacity = '1';
    }, 2500); // Este tiempo es el delay de 1500ms + la duraci√≥n del fade-out de 1000ms
}
</script>
<script>
    // ========= C√ìDIGO P5.JS CON ESFERA DESPLAZADA HACIA ABAJO =========

    let particles = [];
    let centerSphere;
    const maxParticles = 250;
    let iniciarSalida = false;

    function setup() {
        const container = document.getElementById('p5-canvas-container');
        if (!container) return;
        
        const canvas = createCanvas(windowWidth, windowHeight, WEBGL);
        canvas.parent(container);

        centerSphere = new CenterSphere();
        
        while (particles.length < maxParticles) {
            particles.push(new Particle());
        }
    }

    function draw() {
        background(0);
        rotateY(frameCount * 0.005);
        
        // ‚ñº‚ñº‚ñº L√çNEA NUEVA: Desplaza toda la escena 3D hacia abajo ‚ñº‚ñº‚ñº
        // El resultado es que la esfera y las part√≠culas se ven m√°s bajas.
        translate(0, windowHeight * 0.07, 0); 
        
        // El resto del c√≥digo funciona igual
        if (iniciarSalida) {
            centerSphere.shrink();
            for (let p of particles) {
                p.maxSpeed = 25;
                p.applyForce(createVector(0, 0, -2));
                p.update();
                p.display();
            }
        } else {
            let strength = map(sin(frameCount * 0.02), -1, 1, 0, 10);
            let isAttracting = cos(frameCount * 0.02) > 0;
            centerSphere.display();
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.update();
                if (isAttracting) {
                    p.attract(centerSphere.position, strength);
                } else {
                    p.repel(centerSphere.position, strength);
                }
                if (p.isInside(centerSphere.position, centerSphere.size / 2)) {
                    particles.splice(i, 1);
                    particles.push(new Particle());
                } else {
                    p.display();
                }
            }
        }
    }
    
    function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
    }

    // --- Clases para la animaci√≥n (no necesitan cambios) ---
    class CenterSphere {
        constructor() { this.position = createVector(0, 0, 0); this.size = 137; }
        display() { push(); noStroke(); fill(255); sphere(this.size); pop(); }
        shrink() { this.size = lerp(this.size, 0, 0.1); }
    }
    class Particle {
        constructor() { let spawnRadius = max(windowWidth, windowHeight) / 1.5; this.position = p5.Vector.random3D().mult(random(300, spawnRadius)); this.velocity = createVector(); this.acceleration = createVector(); this.size = random(2, 6); this.maxSpeed = 4; }
        applyForce(force) { this.acceleration.add(force); }
        update() { this.velocity.add(this.acceleration); this.velocity.limit(this.maxSpeed); this.position.add(this.velocity); this.acceleration.mult(0); if(this.position.mag() > max(windowWidth, windowHeight)) { let spawnRadius = max(windowWidth, windowHeight) / 1.5; this.position = p5.Vector.random3D().mult(spawnRadius); this.velocity.mult(0); } }
        attract(target, strength) { let force = p5.Vector.sub(target, this.position); let d = force.mag(); d = constrain(d, 5, 100); let g = strength / (d * d); force.normalize().mult(g); this.applyForce(force); }
        repel(target, strength) { let force = p5.Vector.sub(target, this.position); let d = force.mag(); if (d < 250) { d = constrain(d, 5, 250); let g = -strength / (d * d); force.normalize().mult(g); this.applyForce(force); } }
        isInside(target, radius) { return this.position.dist(target) < radius; }
        display() { push(); translate(this.position); noStroke(); fill(255); sphere(this.size); pop(); }
    }
</script>
</body>
</html>
